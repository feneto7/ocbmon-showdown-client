{"version":3,"file":"battle-tooltips.js","names":["ModifiableValue","battle","pokemon","serverPokemon","value","maxValue","comment","itemName","abilityName","weatherName","isAccuracy","dex","items","get","item","name","ability","baseAbility","abilities","weather","moves","exists","_proto","prototype","reset","arguments","length","undefined","tryItem","_this$pokemon","hasPseudoWeather","push","volatiles","ignoreKlutz","tryAbility","includes","_this$pokemon2","_this$pokemon3","effectiveAbility","tryWeather","_i2","_this$battle$sides2","sides","side","_i4","_side$active2","active","itemModify","factor","modify","abilityModify","weatherModify","round","set","reason","setRange","Number","toFixed","toString","valueString","join","BattleTooltips","_this","clickTooltipEvent","e","isLocked","preventDefault","stopImmediatePropagation","holdLockTooltipEvent","hideTooltip","target","currentTarget","showTooltip","type","tagName","longTapTimeout","setTimeout","lockTooltip","LONG_TAP_DELAY","showTooltipEvent","elem","cancelLongTap","parentNode","removeChild","parentElem","$","removeClass","clearTimeout","_proto2","isPressed","addClass","handleTouchEnd","listen","_this2","$elem","on","unshowTooltip","click","args","dataset","tooltip","split","ownHeight","ownheight","buf","move","teamIndex","parseInt","nearSide","pokemonControlled","Math","floor","mySide","n","gmaxMove","myPokemon","showMoveTooltip","sideIndex","species","getBaseSpecies","baseSpecies","index","_i6","_side$pokemon2","otherPokemon","showPokemonTooltip","sidesSwitched","activeIndex","pokemonIndex","ally","myAllyPokemon","showFieldTooltip","Promise","resolve","Error","stack","placeTooltip","innerHTML","hoveredElem","notRelativeToParent","scene","$turn","hoveredX1","offset","left","parent","hoveredY1","top","hoveredY2","outerHeight","x","max","y","$wrapper","document","body","append","selection","window","getSelection","err","css","html","appendTo","find","height","documentElement","clientHeight","width","outerWidth","clientWidth","getStatusZMoveEffect","zMove","effect","zMoveEffects","boostText","boost","boosts","Object","keys","map","stat","BattleTextParser","getMaxMoveFromType","maxMoveTable","isZOrMax","text","zEffect","foeActive","foe","gameType","concat","filter","toID","_this$getMoveType","getMoveType","moveType","category","categoryDiff","zMoveFrom","Move","id","assign","moveName","zMoveTable","zMoveType","movePower","basePower","startsWith","maxMove","Dex","getTypeIcon","getCategoryIcon","showingMultipleBasePowers","prevBasePower","difference","basePowers","_i8","_foeActive2","getMoveBasePower","activeTarget","accuracy","getMoveAccuracy","calls","gen","calledMove","hardcoreMode","shortDesc","priority","desc","flags","defrost","protect","bypasssub","reflectable","contact","sound","powder","punch","pulse","bite","kick","bone","recoil","hasCrashDamage","bullet","slicing","wind","clientPokemon","isActive","illusionIndex","_this3","genderBuf","gender","fxPrefix","toLowerCase","BattleLog","escapeHTML","speciesForme","levelBuf","level","formechange","transform","types","terastallized","teraType","getPokemonTypes","knownPokemon","typechange","typeadd","rules","fainted","hp","maxhp","status","toUpperCase","exacthp","Pokemon","getHPText","min","statusData","toxicTurns","sleepTurns","supportsAbilities","tier","abilityText","getPokemonAbilityText","itemText","itemEffect","prevItem","prevItemEffect","renderStats","battlePokemon","findCorrespondingPokemon","_i0","_serverPokemon$moves2","moveid","moveTrack","_i10","_battlePokemon$moveTr2","row","getPPUseText","_i12","_clientPokemon$moveTr2","_ref","charAt","isZ","isMax","pokemonHasClones","atLeastOne","_i14","_this$battle$sides4","sideConditions","sideConditionsLeft","weatherbuf","weatherLeft","slice","speciesClause","_i16","_side$pokemon4","searchid","calculateModifiedStats","statStagesOnly","_clientPokemon$effect","_clientPokemon$volati","_this$battle$dex$spec","_this4","stats","isPowerTrick","_i18","_Dex$statNamesExceptH2","statNamesExceptHP","statName","sourceStatName","clientStatName","spc","boostLevel","boostTable","atk","spe","_i20","_Dex$statNamesExceptH4","speedHalvingEVItems","isTransform","speciesName","speedModifiers","spa","spd","def","abilityActive","pokemonHasType","allyActive","_i22","allyAbility","getAllyAbility","getSpecies","_i24","_Dex$statNamesExceptH6","isNFE","evos","some","evo","_this4$battle$dex$spe","evoSpecies","isNonstandard","_i26","chainedSpeedModifier","_i28","modifier","ceil","short","isTransformed","_this$getSpeedRange","getSpeedRange","modifiedStats","hasModifiedStat","_i30","_Dex$statNamesExceptH8","statLabel","BattleText","statShortName","_i32","_Dex$statNamesExceptH0","moveTrackRow","showKnown","ppUsed","maxpp","substr","pp","noPPBoosts","Infinity","_i34","_pokemon$moveTrack2","_ref2","_pokemon$volatiles$tr","tr","trunc","baseSpe","baseStats","bstWithoutHp","bst","scale","isCGT","isRandomBattle","minNature","maxNature","maxIv","maxIvEvOffset","forMaxMove","pokemonTypes","getTypeList","onMemory","onPlate","onDrive","naturalGift","isGrounded","getSpeciesForme","noTypeOverride","allowTypeOverride","_pokemon$getTypes","getTypes","i","isSound","ohko","accuracyModifiers","_i36","_pokemon$side$active2","chain","_i38","mod","accuracyAfterChain","multiplier","ratios","ratio","faintCounter","boostCount","_i40","_Object$values2","values","_i42","_Object$values4","ppLeft","_this$getSpeedRange2","minSpe","maxSpe","minRatio","maxRatio","_this$getSpeedRange3","fling","isGKLK","targetWeight","getWeightKg","pokemonWeight","timesAttacked","secondaries","auraBoosted","auraBroken","_i44","_pokemon$side$active4","_i46","_pokemon$side$foe$act2","getItemBoost","_value$pokemon$volati","_BattleTooltips$orbUs","_BattleTooltips$orbTy","incenseTypes","itemTypes","orbUsers","orbTypes","noGemMoves","preterastallized","_i48","_types2","curType","slot","getPokemonAbilityData","abilityData","possibilities","hidePossible","baseAbilityName","Poison","Fighting","Dark","Grass","Normal","Rock","Steel","Dragon","Electric","Water","Fire","Ghost","Bug","Psychic","Ice","Flying","Ground","Fairy","Blood","Bone","Chaos","Cosmic","Crystal","Cyber","Divine","Fabric","Fear","Food","Glass","Greasy","Heart","Light","Magic","Magma","Meme","Nuclear","Ogre","Paint","Paper","Plastic","Qmarks","Rubber","Shadow","Sound","Steam","Tech","Time","Virus","Void","Wack","Wind","Wood","Zombie","Vanilla","Cherry","Strawberry","Apple","Orange","Banana","Lemon","Lime","Blueberry","Grape","Raspberry","Chocolate","BattleStatGuesser","formatid","moveCount","hasMove","ignoreEVLimits","supportsEVs","supportsAVs","isNaN","modMatch","match","genNumber","modName","modified","endsWith","_proto3","guess","role","guessRole","comboEVs","guessEVs","evs","plusStat","minusStat","itemid","abilityid","megaEvolves","megaStone","needsFourMoves","moveids","len","heal","isFast","physicalBulk","specialBulk","bulk","ultrafast","offenseBias","ensureMinEVs","evTotal","diff","change","evPriority","prioStat","ensureMaxEVs","statChart","primaryStat","getStat","ev","secondaryStat","SRweaknesses","SRresistances","SRweak","indexOf","hpDivisibility","hpShouldBeDivisible","remaining","evOverride","natureOverride","_BattleNatures","_BattleNatures2","baseStat","iv","ivs","val","BattleNatures","nature","plus","minus","friendshipValue","require","global"],"sources":["../src/battle-tooltips.ts"],"sourcesContent":["/**\r\n * Pokemon Showdown Tooltips\r\n *\r\n * A file for generating tooltips for battles. This should be IE7+ and\r\n * use the DOM directly.\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license MIT\r\n */\r\n\r\nclass ModifiableValue {\r\n\tvalue = 0;\r\n\tmaxValue = 0;\r\n\tcomment: string[];\r\n\tbattle: Battle;\r\n\tpokemon: Pokemon;\r\n\tserverPokemon: ServerPokemon;\r\n\titemName: string;\r\n\tabilityName: string;\r\n\tweatherName: string;\r\n\tisAccuracy = false;\r\n\tconstructor(battle: Battle, pokemon: Pokemon, serverPokemon: ServerPokemon) {\r\n\t\tthis.comment = [];\r\n\t\tthis.battle = battle;\r\n\t\tthis.pokemon = pokemon;\r\n\t\tthis.serverPokemon = serverPokemon;\r\n\r\n\t\tthis.itemName = this.battle.dex.items.get(serverPokemon.item).name;\r\n\t\tconst ability = serverPokemon.ability || pokemon?.ability || serverPokemon.baseAbility;\r\n\t\tthis.abilityName = this.battle.dex.abilities.get(ability).name;\r\n\t\tthis.weatherName = battle.weather === 'snow' ? 'Snow' : this.battle.dex.moves.get(battle.weather).exists ?\r\n\t\t\tthis.battle.dex.moves.get(battle.weather).name :  this.battle.dex.abilities.get(battle.weather).name;\r\n\t}\r\n\treset(value = 0, isAccuracy?: boolean) {\r\n\t\tthis.value = value;\r\n\t\tthis.maxValue = 0;\r\n\t\tthis.isAccuracy = !!isAccuracy;\r\n\t\tthis.comment = [];\r\n\t}\r\n\ttryItem(itemName: string) {\r\n\t\tif (itemName !== this.itemName) return false;\r\n\t\tif (this.battle.hasPseudoWeather('Magic Room')) {\r\n\t\t\tthis.comment.push(` (${itemName} suppressed by Magic Room)`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (this.pokemon?.volatiles['embargo']) {\r\n\t\t\tthis.comment.push(` (${itemName} suppressed by Embargo)`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tconst ignoreKlutz = [\r\n\t\t\t\"Macho Brace\", \"Power Anklet\", \"Power Band\", \"Power Belt\", \"Power Bracer\", \"Power Lens\", \"Power Weight\",\r\n\t\t];\r\n\t\tif (this.tryAbility('Klutz') && !ignoreKlutz.includes(itemName)) {\r\n\t\t\tthis.comment.push(` (${itemName} suppressed by Klutz)`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\ttryAbility(abilityName: string) {\r\n\t\tif (abilityName !== this.abilityName) return false;\r\n\t\tif (this.pokemon?.volatiles['gastroacid']) {\r\n\t\t\tthis.comment.push(` (${abilityName} suppressed by Gastro Acid)`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t// Check for Neutralizing Gas\r\n\t\tif (!this.pokemon?.effectiveAbility(this.serverPokemon)) return false;\r\n\t\treturn true;\r\n\t}\r\n\ttryWeather(weatherName?: string) {\r\n\t\tif (!this.weatherName) return false;\r\n\t\tif (!weatherName) weatherName = this.weatherName;\r\n\t\telse if (weatherName !== this.weatherName) return false;\r\n\t\tfor (const side of this.battle.sides) {\r\n\t\t\tfor (const active of side.active) {\r\n\t\t\t\tif (active && ['Air Lock', 'Cloud Nine'].includes(active.ability)) {\r\n\t\t\t\t\tthis.comment.push(` (${weatherName} suppressed by ${active.ability})`);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\titemModify(factor: number, itemName?: string) {\r\n\t\tif (!itemName) itemName = this.itemName;\r\n\t\tif (!itemName) return false;\r\n\t\tif (!this.tryItem(itemName)) return false;\r\n\t\treturn this.modify(factor, itemName);\r\n\t}\r\n\tabilityModify(factor: number, abilityName: string) {\r\n\t\tif (!this.tryAbility(abilityName)) return false;\r\n\t\treturn this.modify(factor, abilityName);\r\n\t}\r\n\tweatherModify(factor: number, weatherName?: string, name?: string) {\r\n\t\tif (!weatherName) weatherName = this.weatherName;\r\n\t\tif (!weatherName) return false;\r\n\t\tif (!this.tryWeather(weatherName)) return false;\r\n\t\treturn this.modify(factor, name || weatherName);\r\n\t}\r\n\tmodify(factor: number, name?: string) {\r\n\t\tif (factor === 0) {\r\n\t\t\tif (name) this.comment.push(` (${name})`);\r\n\t\t\tthis.value = 0;\r\n\t\t\tthis.maxValue = 0;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif (name) this.comment.push(` (${this.round(factor)}&times; from ${name})`);\r\n\t\tthis.value *= factor;\r\n\t\tif (!(name === 'Technician' && this.maxValue > 60)) this.maxValue *= factor;\r\n\t\treturn true;\r\n\t}\r\n\tset(value: number, reason?: string) {\r\n\t\tif (reason) this.comment.push(` (${reason})`);\r\n\t\tthis.value = value;\r\n\t\tthis.maxValue = 0;\r\n\t\treturn true;\r\n\t}\r\n\tsetRange(value: number, maxValue: number, reason?: string) {\r\n\t\tif (reason) this.comment.push(` (${reason})`);\r\n\t\tthis.value = value;\r\n\t\tthis.maxValue = maxValue;\r\n\t\treturn true;\r\n\t}\r\n\tround(value: number) {\r\n\t\treturn value ? Number(value.toFixed(2)) : 0;\r\n\t}\r\n\ttoString() {\r\n\t\tlet valueString;\r\n\t\tif (this.isAccuracy) {\r\n\t\t\tvalueString = this.value ? `${this.round(this.value)}%` : `can't miss`;\r\n\t\t} else {\r\n\t\t\tvalueString = this.value ? `${this.round(this.value)}` : ``;\r\n\t\t}\r\n\t\tif (this.maxValue) {\r\n\t\t\tvalueString += ` to ${this.round(this.maxValue)}` + (this.isAccuracy ? '%' : '');\r\n\t\t}\r\n\t\treturn valueString + this.comment.join('');\r\n\t}\r\n}\r\n\r\nclass BattleTooltips {\r\n\tbattle: Battle;\r\n\r\n\tconstructor(battle: Battle) {\r\n\t\tthis.battle = battle;\r\n\t}\r\n\r\n\t// tooltips\r\n\t// Touch delay, pressing finger more than that time will cause the tooltip to open.\r\n\t// Shorter time will cause the button to click\r\n\tstatic LONG_TAP_DELAY = 350; // ms\r\n\tstatic longTapTimeout = 0;\r\n\tstatic elem: HTMLDivElement | null = null;\r\n\tstatic parentElem: HTMLElement | null = null;\r\n\tstatic isLocked = false;\r\n\tstatic isPressed = false;\r\n\r\n\tstatic hideTooltip() {\r\n\t\tif (!BattleTooltips.elem) return;\r\n\t\tBattleTooltips.cancelLongTap();\r\n\t\tBattleTooltips.elem.parentNode!.removeChild(BattleTooltips.elem);\r\n\t\tBattleTooltips.elem = null;\r\n\t\tBattleTooltips.parentElem = null;\r\n\t\tBattleTooltips.isLocked = false;\r\n\t\t$('#tooltipwrapper').removeClass('tooltip-locked');\r\n\t}\r\n\r\n\tstatic cancelLongTap() {\r\n\t\tif (BattleTooltips.longTapTimeout) {\r\n\t\t\tclearTimeout(BattleTooltips.longTapTimeout);\r\n\t\t\tBattleTooltips.longTapTimeout = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tlockTooltip() {\r\n\t\tif (BattleTooltips.elem && !BattleTooltips.isLocked) {\r\n\t\t\tBattleTooltips.isLocked = true;\r\n\t\t\tif (BattleTooltips.isPressed) {\r\n\t\t\t\t$(BattleTooltips.parentElem!).removeClass('pressed');\r\n\t\t\t\tBattleTooltips.isPressed = false;\r\n\t\t\t}\r\n\t\t\t$('#tooltipwrapper').addClass('tooltip-locked');\r\n\t\t}\r\n\t}\r\n\r\n\thandleTouchEnd(e: TouchEvent) {\r\n\t\tBattleTooltips.cancelLongTap();\r\n\r\n\t\tif (!BattleTooltips.isLocked) BattleTooltips.hideTooltip();\r\n\t}\r\n\r\n\tlisten(elem: HTMLElement | JQuery<HTMLElement>) {\r\n\t\tconst $elem = $(elem);\r\n\t\t$elem.on('mouseover', '.has-tooltip', this.showTooltipEvent);\r\n\t\t$elem.on('click', '.has-tooltip', this.clickTooltipEvent);\r\n\t\t$elem.on('focus', '.has-tooltip', this.showTooltipEvent);\r\n\t\t$elem.on('mouseout', '.has-tooltip', BattleTooltips.unshowTooltip);\r\n\t\t$elem.on('mousedown', '.has-tooltip', this.holdLockTooltipEvent);\r\n\t\t$elem.on('blur', '.has-tooltip', BattleTooltips.unshowTooltip);\r\n\t\t$elem.on('mouseup', '.has-tooltip', BattleTooltips.unshowTooltip);\r\n\r\n\t\t$elem.on('touchstart', '.has-tooltip', e => {\r\n\t\t\te.preventDefault();\r\n\t\t\tthis.holdLockTooltipEvent(e);\r\n\t\t\tif (!BattleTooltips.parentElem) {\r\n\t\t\t\t// should never happen, but in case there's a bug in the tooltip handler\r\n\t\t\t\tBattleTooltips.parentElem = e.currentTarget;\r\n\t\t\t}\r\n\t\t\t$(BattleTooltips.parentElem!).addClass('pressed');\r\n\t\t\tBattleTooltips.isPressed = true;\r\n\t\t});\r\n\t\t$elem.on('touchend', '.has-tooltip', e => {\r\n\t\t\te.preventDefault();\r\n\t\t\tif (e.currentTarget === BattleTooltips.parentElem && BattleTooltips.isPressed) {\r\n\t\t\t\tBattleTooltips.parentElem!.click();\r\n\t\t\t}\r\n\t\t\tBattleTooltips.unshowTooltip();\r\n\t\t});\r\n\t\t$elem.on('touchleave', '.has-tooltip', BattleTooltips.unshowTooltip);\r\n\t\t$elem.on('touchcancel', '.has-tooltip', BattleTooltips.unshowTooltip);\r\n\t}\r\n\r\n\tclickTooltipEvent = (e: Event) => {\r\n\t\tif (BattleTooltips.isLocked) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopImmediatePropagation();\r\n\t\t}\r\n\t};\r\n\t/**\r\n\t * An event that will lock a tooltip if held down\r\n\t *\r\n\t * (Namely, a long-tap or long-click)\r\n\t */\r\n\tholdLockTooltipEvent = (e: JQuery.TriggeredEvent) => {\r\n\t\tif (BattleTooltips.isLocked) BattleTooltips.hideTooltip();\r\n\t\tconst target = e.currentTarget as HTMLElement;\r\n\t\tthis.showTooltip(target);\r\n\t\tlet factor = (e.type === 'mousedown' && target.tagName === 'BUTTON' ? 2 : 1);\r\n\r\n\t\tBattleTooltips.longTapTimeout = setTimeout(() => {\r\n\t\t\tBattleTooltips.longTapTimeout = 0;\r\n\t\t\tthis.lockTooltip();\r\n\t\t}, BattleTooltips.LONG_TAP_DELAY * factor);\r\n\t};\r\n\r\n\tshowTooltipEvent = (e: Event) => {\r\n\t\tif (BattleTooltips.isLocked) return;\r\n\t\tthis.showTooltip(e.currentTarget as HTMLElement);\r\n\t};\r\n\r\n\t/**\r\n\t * Only hides tooltips if they're not locked\r\n\t */\r\n\tstatic unshowTooltip() {\r\n\t\tif (BattleTooltips.isLocked) return;\r\n\t\tif (BattleTooltips.isPressed) {\r\n\t\t\t$(BattleTooltips.parentElem!).removeClass('pressed');\r\n\t\t\tBattleTooltips.isPressed = false;\r\n\t\t}\r\n\t\tBattleTooltips.hideTooltip();\r\n\t}\r\n\r\n\tshowTooltip(elem: HTMLElement) {\r\n\t\tconst args = (elem.dataset.tooltip || '').split('|');\r\n\t\tconst [type] = args;\r\n\t\t/**\r\n\t\t * If false, we instead attach the tooltip above the parent element.\r\n\t\t * This is important for the move/switch menus so the tooltip doesn't\r\n\t\t * cover up buttons above the hovered button.\r\n\t\t */\r\n\t\tlet ownHeight = !!elem.dataset.ownheight;\r\n\r\n\t\tlet buf: string;\r\n\t\tswitch (type) {\r\n\t\tcase 'move':\r\n\t\tcase 'zmove':\r\n\t\tcase 'maxmove': { // move|MOVE|ACTIVEPOKEMON|[GMAXMOVE]\r\n\t\t\tlet move = this.battle.dex.moves.get(args[1]);\r\n\t\t\tlet teamIndex = parseInt(args[2], 10);\r\n\t\t\tlet pokemon = this.battle.nearSide.active[\r\n\t\t\t\tteamIndex + this.battle.pokemonControlled * Math.floor(this.battle.mySide.n / 2)\r\n\t\t\t];\r\n\t\t\tlet gmaxMove = args[3] ? this.battle.dex.moves.get(args[3]) : undefined;\r\n\t\t\tif (!pokemon) return false;\r\n\t\t\tlet serverPokemon = this.battle.myPokemon![teamIndex];\r\n\t\t\tbuf = this.showMoveTooltip(move, type, pokemon, serverPokemon, gmaxMove);\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tcase 'pokemon': { // pokemon|SIDE|POKEMON\r\n\t\t\t// mouse over sidebar pokemon\r\n\t\t\t// pokemon definitely exists, serverPokemon always ignored\r\n\t\t\tlet sideIndex = parseInt(args[1], 10);\r\n\t\t\tlet side = this.battle.sides[sideIndex];\r\n\t\t\tlet pokemon = side.pokemon[parseInt(args[2], 10)];\r\n\t\t\tif (args[3] === 'illusion') {\r\n\t\t\t\tbuf = '';\r\n\t\t\t\tconst species = pokemon.getBaseSpecies().baseSpecies;\r\n\t\t\t\tlet index = 1;\r\n\t\t\t\tfor (const otherPokemon of side.pokemon) {\r\n\t\t\t\t\tif (otherPokemon.getBaseSpecies().baseSpecies === species) {\r\n\t\t\t\t\t\tbuf += this.showPokemonTooltip(otherPokemon, null, false, index);\r\n\t\t\t\t\t\tindex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tbuf = this.showPokemonTooltip(pokemon);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'activepokemon': { // activepokemon|SIDE|ACTIVE\r\n\t\t\t// mouse over active pokemon\r\n\t\t\t// pokemon definitely exists, serverPokemon maybe\r\n\t\t\tlet sideIndex = parseInt(args[1], 10);\r\n\t\t\tlet side = this.battle.sides[+this.battle.sidesSwitched ^ sideIndex];\r\n\t\t\tlet activeIndex = parseInt(args[2], 10);\r\n\t\t\tlet pokemonIndex = activeIndex;\r\n\t\t\tif (activeIndex >= 1 && this.battle.sides.length > 2) {\r\n\t\t\t\tpokemonIndex -= 1;\r\n\t\t\t\tside = this.battle.sides[side.n + 2];\r\n\t\t\t}\r\n\t\t\tlet pokemon = side.active[activeIndex];\r\n\t\t\tlet serverPokemon = null;\r\n\t\t\tif (side === this.battle.mySide && this.battle.myPokemon) {\r\n\t\t\t\tserverPokemon = this.battle.myPokemon[pokemonIndex];\r\n\t\t\t}\r\n\t\t\tif (side === this.battle.mySide.ally && this.battle.myAllyPokemon) {\r\n\t\t\t\tserverPokemon = this.battle.myAllyPokemon[pokemonIndex];\r\n\t\t\t}\r\n\t\t\tif (!pokemon) return false;\r\n\t\t\tbuf = this.showPokemonTooltip(pokemon, serverPokemon, true);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'switchpokemon': { // switchpokemon|POKEMON\r\n\t\t\t// mouse over switchable pokemon\r\n\t\t\t// serverPokemon definitely exists, sidePokemon maybe\r\n\t\t\t// let side = this.battle.mySide;\r\n\t\t\tlet activeIndex = parseInt(args[1], 10);\r\n\t\t\tlet pokemon = null;\r\n\t\t\t/* if (activeIndex < side.active.length && activeIndex < this.battle.pokemonControlled) {\r\n\t\t\t\tpokemon = side.active[activeIndex];\r\n\t\t\t\tif (pokemon && pokemon.side === side.ally) pokemon = null;\r\n\t\t\t} */\r\n\t\t\tlet serverPokemon = this.battle.myPokemon![activeIndex];\r\n\t\t\tbuf = this.showPokemonTooltip(pokemon, serverPokemon);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'allypokemon': { // allypokemon|POKEMON\r\n\t\t\t// mouse over ally's pokemon in multi battles\r\n\t\t\t// serverPokemon definitely exists, sidePokemon maybe\r\n\t\t\t// let side = this.battle.mySide.ally;\r\n\t\t\tlet activeIndex = parseInt(args[1], 10);\r\n\t\t\tlet pokemon = null;\r\n\t\t\t/*if (activeIndex < side.pokemon.length) {\r\n\t\t\t\tpokemon = side.pokemon[activeIndex] || side.ally ? side.ally.pokemon[activeIndex] : null;\r\n\t\t\t}*/\r\n\t\t\tlet serverPokemon = this.battle.myAllyPokemon ? this.battle.myAllyPokemon[activeIndex] : null;\r\n\t\t\tbuf = this.showPokemonTooltip(pokemon, serverPokemon);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'field': {\r\n\t\t\tbuf = this.showFieldTooltip();\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tdefault:\r\n\t\t\t// \"throws\" an error without crashing\r\n\t\t\tPromise.resolve(new Error(`unrecognized type`));\r\n\t\t\tbuf = `<p class=\"message-error\" style=\"white-space: pre-wrap\">${new Error(`unrecognized type`).stack}</p>`;\r\n\t\t}\r\n\r\n\t\tthis.placeTooltip(buf, elem, ownHeight, type);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tplaceTooltip(innerHTML: string, hoveredElem?: HTMLElement, notRelativeToParent?: boolean, type?: string) {\r\n\t\tlet $elem;\r\n\t\tif (hoveredElem) {\r\n\t\t\t$elem = $(hoveredElem);\r\n\t\t} else {\r\n\t\t\t$elem = (this.battle.scene as BattleScene).$turn;\r\n\t\t\tnotRelativeToParent = true;\r\n\t\t}\r\n\r\n\t\tlet hoveredX1 = $elem.offset()!.left;\r\n\r\n\t\tif (!notRelativeToParent) {\r\n\t\t\t$elem = $elem.parent();\r\n\t\t}\r\n\r\n\t\tlet hoveredY1 = $elem.offset()!.top;\r\n\t\tlet hoveredY2 = hoveredY1 + $elem.outerHeight()!;\r\n\r\n\t\t// (x, y) are the left and top offsets of #tooltipwrapper, which mark the\r\n\t\t// BOTTOM LEFT CORNER of the tooltip\r\n\r\n\t\tlet x = Math.max(hoveredX1 - 2, 0);\r\n\t\tlet y = Math.max(hoveredY1 - 5, 0);\r\n\r\n\t\tlet $wrapper = $('#tooltipwrapper');\r\n\t\tif (!$wrapper.length) {\r\n\t\t\t$wrapper = $(`<div id=\"tooltipwrapper\" role=\"tooltip\"></div>`);\r\n\t\t\t$(document.body).append($wrapper);\r\n\t\t\t$wrapper.on('click', e => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst selection = window.getSelection()!;\r\n\t\t\t\t\tif (selection.type === 'Range') return;\r\n\t\t\t\t} catch (err) {}\r\n\t\t\t\tBattleTooltips.hideTooltip();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t$wrapper.removeClass('tooltip-locked');\r\n\t\t}\r\n\t\t$wrapper.css({\r\n\t\t\tleft: x,\r\n\t\t\ttop: y,\r\n\t\t});\r\n\t\tinnerHTML = `<div class=\"tooltipinner\"><div class=\"tooltip tooltip-${type}\">${innerHTML}</div></div>`;\r\n\t\t$wrapper.html(innerHTML).appendTo(document.body);\r\n\t\tBattleTooltips.elem = $wrapper.find('.tooltip')[0] as HTMLDivElement;\r\n\t\tBattleTooltips.isLocked = false;\r\n\r\n\t\tlet height = $(BattleTooltips.elem).outerHeight()!;\r\n\t\tif (y - height < 1) {\r\n\t\t\t// tooltip is too tall to fit above the element:\r\n\t\t\t// try to fit it below it instead\r\n\t\t\ty = hoveredY2 + height + 5;\r\n\t\t\tif (y > document.documentElement.clientHeight) {\r\n\t\t\t\t// tooltip is also too tall to fit below the element:\r\n\t\t\t\t// just place it at the top of the screen\r\n\t\t\t\ty = height + 1;\r\n\t\t\t}\r\n\t\t\t$wrapper.css('top', y);\r\n\t\t} else if (y < 75) {\r\n\t\t\t// tooltip is pretty high up, put it below the element if it fits\r\n\t\t\ty = hoveredY2 + height + 5;\r\n\t\t\tif (y < document.documentElement.clientHeight) {\r\n\t\t\t\t// it fits\r\n\t\t\t\t$wrapper.css('top', y);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet width = $(BattleTooltips.elem).outerWidth()!;\r\n\t\tif (x > document.documentElement.clientWidth - width - 2) {\r\n\t\t\tx = document.documentElement.clientWidth - width - 2;\r\n\t\t\t$wrapper.css('left', x);\r\n\t\t}\r\n\r\n\t\tBattleTooltips.parentElem = hoveredElem || null;\r\n\t\treturn true;\r\n\t}\r\n\r\n\thideTooltip() {\r\n\t\tBattleTooltips.hideTooltip();\r\n\t}\r\n\r\n\tstatic zMoveEffects: {[zEffect: string]: string} = {\r\n\t\t'clearnegativeboost': \"Restores negative stat stages to 0\",\r\n\t\t'crit2': \"Crit ratio +2\",\r\n\t\t'heal': \"Restores HP 100%\",\r\n\t\t'curse': \"Restores HP 100% if user is Ghost type, otherwise Attack +1\",\r\n\t\t'redirect': \"Redirects opposing attacks to user\",\r\n\t\t'healreplacement': \"Restores replacement's HP 100%\",\r\n\t};\r\n\r\n\tgetStatusZMoveEffect(move: Move) {\r\n\t\tif (move.zMove!.effect! in BattleTooltips.zMoveEffects) {\r\n\t\t\treturn BattleTooltips.zMoveEffects[move.zMove!.effect!];\r\n\t\t}\r\n\t\tlet boostText = '';\r\n\t\tif (move.zMove!.boost) {\r\n\t\t\tlet boosts = Object.keys(move.zMove!.boost) as StatName[];\r\n\t\t\tboostText = boosts.map(stat =>\r\n\t\t\t\tBattleTextParser.stat(stat) + ' +' + move.zMove!.boost![stat]\r\n\t\t\t).join(', ');\r\n\t\t}\r\n\t\treturn boostText;\r\n\t}\r\n\r\n\tstatic zMoveTable: {[type in TypeName]: string} = {\r\n\t\tPoison: \"Acid Downpour\",\r\n\t\tFighting: \"All-Out Pummeling\",\r\n\t\tDark: \"Black Hole Eclipse\",\r\n\t\tGrass: \"Bloom Doom\",\r\n\t\tNormal: \"Breakneck Blitz\",\r\n\t\tRock: \"Continental Crush\",\r\n\t\tSteel: \"Corkscrew Crash\",\r\n\t\tDragon: \"Devastating Drake\",\r\n\t\tElectric: \"Gigavolt Havoc\",\r\n\t\tWater: \"Hydro Vortex\",\r\n\t\tFire: \"Inferno Overdrive\",\r\n\t\tGhost: \"Never-Ending Nightmare\",\r\n\t\tBug: \"Savage Spin-Out\",\r\n\t\tPsychic: \"Shattered Psyche\",\r\n\t\tIce: \"Subzero Slammer\",\r\n\t\tFlying: \"Supersonic Skystrike\",\r\n\t\tGround: \"Tectonic Rage\",\r\n\t\tFairy: \"Twinkle Tackle\",\r\n\t\t\"???\": \"\",\r\n\t\tBlood: \"\",\r\n\t\tBone: \"\",\r\n\t\tChaos: \"\",\r\n\t\tCosmic: \"\",\r\n\t\tCrystal: \"\",\r\n\t\tCyber: \"\",\r\n\t\tDivine: \"\",\r\n\t\tFabric: \"\",\r\n\t\tFear: \"\",\r\n\t\tFood: \"\",\r\n\t\tGlass: \"\",\r\n\t\tGreasy: \"\",\r\n\t\tHeart: \"\",\r\n\t\tLight: \"\",\r\n\t\tMagic: \"\",\r\n\t\tMagma: \"\",\r\n\t\tMeme: \"\",\r\n\t\tNuclear: \"\",\r\n\t\tOgre: \"\",\r\n\t\tPaint: \"\",\r\n\t\tPaper: \"\",\r\n\t\tPlastic: \"\",\r\n\t\tQmarks: \"\",\r\n\t\tRubber: \"\",\r\n\t\tShadow: \"\",\r\n\t\tSound: \"\",\r\n\t\tSteam: \"\",\r\n\t\tTech: \"\",\r\n\t\tTime: \"\",\r\n\t\tVirus: \"\",\r\n\t\tVoid: \"\",\r\n\t\tWack: \"\",\r\n\t\tWind: \"\",\r\n\t\tWood: \"\",\r\n\t\tZombie: \"\",\r\n\t\tVanilla: \"\",\r\n\t\tCherry: \"\",\r\n\t\tStrawberry: \"\",\r\n\t\tApple: \"\",\r\n\t\tOrange: \"\",\r\n\t\tBanana: \"\",\r\n\t\tLemon: \"\",\r\n\t\tLime: \"\",\r\n\t\tBlueberry: \"\",\r\n\t\tGrape: \"\",\r\n\t\tRaspberry: \"\",\r\n\t\tChocolate: \"\"\r\n\t};\r\n\r\n\tstatic maxMoveTable: {[type in TypeName]: string} = {\r\n\t\tPoison: \"Max Ooze\",\r\n\t\tFighting: \"Max Knuckle\",\r\n\t\tDark: \"Max Darkness\",\r\n\t\tGrass: \"Max Overgrowth\",\r\n\t\tNormal: \"Max Strike\",\r\n\t\tRock: \"Max Rockfall\",\r\n\t\tSteel: \"Max Steelspike\",\r\n\t\tDragon: \"Max Wyrmwind\",\r\n\t\tElectric: \"Max Lightning\",\r\n\t\tWater: \"Max Geyser\",\r\n\t\tFire: \"Max Flare\",\r\n\t\tGhost: \"Max Phantasm\",\r\n\t\tBug: \"Max Flutterby\",\r\n\t\tPsychic: \"Max Mindstorm\",\r\n\t\tIce: \"Max Hailstorm\",\r\n\t\tFlying: \"Max Airstream\",\r\n\t\tGround: \"Max Quake\",\r\n\t\tFairy: \"Max Starfall\",\r\n\t\t\"???\": \"Max Memeitude\",\r\n\t\tBlood: \"\",\r\n\t\tBone: \"\",\r\n\t\tChaos: \"\",\r\n\t\tCosmic: \"\",\r\n\t\tCrystal: \"\",\r\n\t\tCyber: \"\",\r\n\t\tDivine: \"\",\r\n\t\tFabric: \"\",\r\n\t\tFear: \"\",\r\n\t\tFood: \"\",\r\n\t\tGlass: \"\",\r\n\t\tGreasy: \"\",\r\n\t\tHeart: \"\",\r\n\t\tLight: \"\",\r\n\t\tMagic: \"\",\r\n\t\tMagma: \"\",\r\n\t\tMeme: \"\",\r\n\t\tNuclear: \"\",\r\n\t\tOgre: \"\",\r\n\t\tPaint: \"\",\r\n\t\tPaper: \"\",\r\n\t\tPlastic: \"\",\r\n\t\tQmarks: \"\",\r\n\t\tRubber: \"\",\r\n\t\tShadow: \"\",\r\n\t\tSound: \"\",\r\n\t\tSteam: \"\",\r\n\t\tTech: \"\",\r\n\t\tTime: \"\",\r\n\t\tVirus: \"\",\r\n\t\tVoid: \"\",\r\n\t\tWack: \"\",\r\n\t\tWind: \"\",\r\n\t\tWood: \"\",\r\n\t\tZombie: \"\",\r\n\t\tVanilla: \"\",\r\n\t\tCherry: \"\",\r\n\t\tStrawberry: \"\",\r\n\t\tApple: \"\",\r\n\t\tOrange: \"\",\r\n\t\tBanana: \"\",\r\n\t\tLemon: \"\",\r\n\t\tLime: \"\",\r\n\t\tBlueberry: \"\",\r\n\t\tGrape: \"\",\r\n\t\tRaspberry: \"\",\r\n\t\tChocolate: \"\"\r\n\t};\r\n\r\n\tgetMaxMoveFromType(type: TypeName, gmaxMove?: string | Move) {\r\n\t\tif (gmaxMove) {\r\n\t\t\tgmaxMove = this.battle.dex.moves.get(typeof gmaxMove === 'string' ? gmaxMove : gmaxMove.name);\r\n\t\t\tif (type === gmaxMove.type) return gmaxMove;\r\n\t\t}\r\n\t\treturn this.battle.dex.moves.get(BattleTooltips.maxMoveTable[type]);\r\n\t}\r\n\r\n\tshowMoveTooltip(move: Move, isZOrMax: string, pokemon: Pokemon, serverPokemon: ServerPokemon, gmaxMove?: Move) {\r\n\t\tlet text = '';\r\n\r\n\t\tlet zEffect = '';\r\n\t\tlet foeActive = pokemon.side.foe.active;\r\n\t\tif (this.battle.gameType === 'freeforall') {\r\n\t\t\tfoeActive = [...foeActive, ...pokemon.side.active].filter(active => active !== pokemon);\r\n\t\t}\r\n\t\t// TODO: move this somewhere it makes more sense\r\n\t\tif (pokemon.ability === '(suppressed)') serverPokemon.ability = '(suppressed)';\r\n\t\tlet ability = toID(serverPokemon.ability || pokemon.ability || serverPokemon.baseAbility);\r\n\t\tlet item = this.battle.dex.items.get(serverPokemon.item);\r\n\r\n\t\tlet value = new ModifiableValue(this.battle, pokemon, serverPokemon);\r\n\t\tlet [moveType, category] = this.getMoveType(move, value, gmaxMove || isZOrMax === 'maxmove');\r\n\t\tlet categoryDiff = move.category !== category;\r\n\r\n\t\tif (isZOrMax === 'zmove') {\r\n\t\t\tif (item.zMoveFrom === move.name) {\r\n\t\t\t\tmove = this.battle.dex.moves.get(item.zMove as string);\r\n\t\t\t} else if (move.category === 'Status') {\r\n\t\t\t\tmove = new Move(move.id, \"\", {\r\n\t\t\t\t\t...move,\r\n\t\t\t\t\tname: 'Z-' + move.name,\r\n\t\t\t\t});\r\n\t\t\t\tzEffect = this.getStatusZMoveEffect(move);\r\n\t\t\t} else {\r\n\t\t\t\tlet moveName = BattleTooltips.zMoveTable[item.zMoveType as TypeName];\r\n\t\t\t\tlet zMove = this.battle.dex.moves.get(moveName);\r\n\t\t\t\tlet movePower = move.zMove!.basePower;\r\n\t\t\t\t// the different Hidden Power types don't have a Z power set, fall back on base move\r\n\t\t\t\tif (!movePower && move.id.startsWith('hiddenpower')) {\r\n\t\t\t\t\tmovePower = this.battle.dex.moves.get('hiddenpower').zMove!.basePower;\r\n\t\t\t\t}\r\n\t\t\t\tif (move.id === 'weatherball') {\r\n\t\t\t\t\tswitch (this.battle.weather) {\r\n\t\t\t\t\tcase 'sunnyday':\r\n\t\t\t\t\tcase 'desolateland':\r\n\t\t\t\t\t\tzMove = this.battle.dex.moves.get(BattleTooltips.zMoveTable['Fire']);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'raindance':\r\n\t\t\t\t\tcase 'primordialsea':\r\n\t\t\t\t\t\tzMove = this.battle.dex.moves.get(BattleTooltips.zMoveTable['Water']);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'sandstorm':\r\n\t\t\t\t\t\tzMove = this.battle.dex.moves.get(BattleTooltips.zMoveTable['Rock']);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'hail':\r\n\t\t\t\t\tcase 'snow':\r\n\t\t\t\t\t\tzMove = this.battle.dex.moves.get(BattleTooltips.zMoveTable['Ice']);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tmove = new Move(zMove.id, zMove.name, {\r\n\t\t\t\t\t...zMove,\r\n\t\t\t\t\tcategory: move.category,\r\n\t\t\t\t\tbasePower: movePower,\r\n\t\t\t\t});\r\n\t\t\t\tcategoryDiff = false;\r\n\t\t\t}\r\n\t\t} else if (isZOrMax === 'maxmove') {\r\n\t\t\tif (move.category === 'Status') {\r\n\t\t\t\tmove = this.battle.dex.moves.get('Max Guard');\r\n\t\t\t} else {\r\n\t\t\t\tlet maxMove = this.getMaxMoveFromType(moveType, gmaxMove);\r\n\t\t\t\tconst basePower = ['gmaxdrumsolo', 'gmaxfireball', 'gmaxhydrosnipe'].includes(maxMove.id) ?\r\n\t\t\t\t\tmaxMove.basePower : move.maxMove.basePower;\r\n\t\t\t\tmove = new Move(maxMove.id, maxMove.name, {\r\n\t\t\t\t\t...maxMove,\r\n\t\t\t\t\tcategory: move.category,\r\n\t\t\t\t\tbasePower,\r\n\t\t\t\t});\r\n\t\t\t\tcategoryDiff = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (categoryDiff) {\r\n\t\t\tmove = new Move(move.id, move.name, {\r\n\t\t\t\t...move,\r\n\t\t\t\tcategory,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\ttext += '<h2>' + move.name + '<br />';\r\n\r\n\t\ttext += Dex.getTypeIcon(moveType);\r\n\t\ttext += ` ${Dex.getCategoryIcon(category)}</h2>`;\r\n\r\n\t\t// Check if there are more than one active Pokémon to check for multiple possible BPs.\r\n\t\tlet showingMultipleBasePowers = false;\r\n\t\tif (category !== 'Status' && foeActive.length > 1) {\r\n\t\t\t// We check if there is a difference in base powers to note it.\r\n\t\t\t// Otherwise, it is just shown as in singles.\r\n\t\t\t// The trick is that we need to calculate it first for each Pokémon to see if it changes.\r\n\t\t\tlet prevBasePower: string | null = null;\r\n\t\t\tlet basePower: string = '';\r\n\t\t\tlet difference = false;\r\n\t\t\tlet basePowers = [];\r\n\t\t\tfor (const active of foeActive) {\r\n\t\t\t\tif (!active) continue;\r\n\t\t\t\tvalue = this.getMoveBasePower(move, moveType, value, active);\r\n\t\t\t\tbasePower = '' + value;\r\n\t\t\t\tif (prevBasePower === null) prevBasePower = basePower;\r\n\t\t\t\tif (prevBasePower !== basePower) difference = true;\r\n\t\t\t\tbasePowers.push('Base power vs ' + active.name + ': ' + basePower);\r\n\t\t\t}\r\n\t\t\tif (difference) {\r\n\t\t\t\ttext += '<p>' + basePowers.join('<br />') + '</p>';\r\n\t\t\t\tshowingMultipleBasePowers = true;\r\n\t\t\t}\r\n\t\t\t// Falls through to not to repeat code on showing the base power.\r\n\t\t}\r\n\t\tif (!showingMultipleBasePowers && category !== 'Status') {\r\n\t\t\tlet activeTarget = foeActive[0] || foeActive[1] || foeActive[2];\r\n\t\t\tvalue = this.getMoveBasePower(move, moveType, value, activeTarget);\r\n\t\t\ttext += '<p>Base power: ' + value + '</p>';\r\n\t\t}\r\n\r\n\t\tlet accuracy = this.getMoveAccuracy(move, value);\r\n\r\n\t\t// Deal with Nature Power special case, indicating which move it calls.\r\n\t\tif (move.id === 'naturepower') {\r\n\t\t\tlet calls;\r\n\t\t\tif (this.battle.gen > 5) {\r\n\t\t\t\tif (this.battle.hasPseudoWeather('Electric Terrain')) {\r\n\t\t\t\t\tcalls = 'Thunderbolt';\r\n\t\t\t\t} else if (this.battle.hasPseudoWeather('Grassy Terrain')) {\r\n\t\t\t\t\tcalls = 'Energy Ball';\r\n\t\t\t\t} else if (this.battle.hasPseudoWeather('Misty Terrain')) {\r\n\t\t\t\t\tcalls = 'Moonblast';\r\n\t\t\t\t} else if (this.battle.hasPseudoWeather('Psychic Terrain')) {\r\n\t\t\t\t\tcalls = 'Psychic';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcalls = 'Tri Attack';\r\n\t\t\t\t}\r\n\t\t\t} else if (this.battle.gen > 3) {\r\n\t\t\t\t// In gens 4 and 5 it calls Earthquake.\r\n\t\t\t\tcalls = 'Earthquake';\r\n\t\t\t} else {\r\n\t\t\t\t// In gen 3 it calls Swift, so it retains its normal typing.\r\n\t\t\t\tcalls = 'Swift';\r\n\t\t\t}\r\n\t\t\tlet calledMove = this.battle.dex.moves.get(calls);\r\n\t\t\ttext += 'Calls ' + Dex.getTypeIcon(this.getMoveType(calledMove, value)[0]) + ' ' + calledMove.name;\r\n\t\t}\r\n\r\n\t\ttext += '<p>Accuracy: ' + accuracy + '</p>';\r\n\t\tif (zEffect) text += '<p>Z-Effect: ' + zEffect + '</p>';\r\n\r\n\t\tif (this.battle.hardcoreMode) {\r\n\t\t\ttext += '<p class=\"section\">' + move.shortDesc + '</p>';\r\n\t\t} else {\r\n\t\t\ttext += '<p class=\"section\">';\r\n\t\t\tif (move.priority > 1) {\r\n\t\t\t\ttext += 'Nearly always moves first <em>(priority +' + move.priority + ')</em>.</p><p>';\r\n\t\t\t} else if (move.priority <= -1) {\r\n\t\t\t\ttext += 'Nearly always moves last <em>(priority &minus;' + (-move.priority) + ')</em>.</p><p>';\r\n\t\t\t} else if (move.priority === 1) {\r\n\t\t\t\ttext += 'Usually moves first <em>(priority +' + move.priority + ')</em>.</p><p>';\r\n\t\t\t} else {\r\n\t\t\t\tif (move.id === 'grassyglide' && this.battle.hasPseudoWeather('Grassy Terrain')) {\r\n\t\t\t\t\ttext += 'Usually moves first <em>(priority +1)</em>.</p><p>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttext += '' + (move.desc || move.shortDesc || '') + '</p>';\r\n\r\n\t\t\tif (this.battle.gameType === 'doubles' || this.battle.gameType === 'multi') {\r\n\t\t\t\tif (move.target === 'allAdjacent') {\r\n\t\t\t\t\ttext += '<p>&#x25ce; Hits both foes and ally.</p>';\r\n\t\t\t\t} else if (move.target === 'allAdjacentFoes') {\r\n\t\t\t\t\ttext += '<p>&#x25ce; Hits both foes.</p>';\r\n\t\t\t\t}\r\n\t\t\t} else if (this.battle.gameType === 'triples') {\r\n\t\t\t\tif (move.target === 'allAdjacent') {\r\n\t\t\t\t\ttext += '<p>&#x25ce; Hits adjacent foes and allies.</p>';\r\n\t\t\t\t} else if (move.target === 'allAdjacentFoes') {\r\n\t\t\t\t\ttext += '<p>&#x25ce; Hits adjacent foes.</p>';\r\n\t\t\t\t} else if (move.target === 'any') {\r\n\t\t\t\t\ttext += '<p>&#x25ce; Can target distant Pok&eacute;mon in Triples.</p>';\r\n\t\t\t\t}\r\n\t\t\t} else if (this.battle.gameType === 'freeforall') {\r\n\t\t\t\tif (move.target === 'allAdjacent' || move.target === 'allAdjacentFoes') {\r\n\t\t\t\t\ttext += '<p>&#x25ce; Hits all foes.</p>';\r\n\t\t\t\t} else if (move.target === 'adjacentAlly') {\r\n\t\t\t\t\ttext += '<p>&#x25ce; Can target any foe in Free-For-All.</p>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (move.flags.defrost) {\r\n\t\t\t\ttext += `<p class=\"movetag\">The user thaws out if it is frozen.</p>`;\r\n\t\t\t}\r\n\t\t\tif (!move.flags.protect && !['self', 'allySide'].includes(move.target)) {\r\n\t\t\t\ttext += `<p class=\"movetag\">Not blocked by Protect <small>(and Detect, King's Shield, Spiky Shield)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.bypasssub) {\r\n\t\t\t\ttext += `<p class=\"movetag\">Bypasses Substitute <small>(but does not break it)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (!move.flags.reflectable && !['self', 'allySide'].includes(move.target) && move.category === 'Status') {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Not bounceable <small>(can't be bounced by Magic Coat/Bounce)</small></p>`;\r\n\t\t\t}\r\n\r\n\t\t\tif (move.flags.contact) {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Contact <small>(triggers Iron Barbs, Spiky Shield, etc)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.sound) {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Sound <small>(doesn't affect Soundproof pokemon)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.powder && this.battle.gen > 5) {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Powder <small>(doesn't affect Grass, Overcoat, Safety Goggles)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.punch && ability === 'ironfist') {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Fist <small>(boosted by Iron Fist)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.pulse && ability === 'megalauncher') {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Pulse <small>(boosted by Mega Launcher)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.bite && ability === 'strongjaw') {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Bite <small>(boosted by Strong Jaw)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.kick && ability === 'striker') {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Kick <small>(affected by Striker)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.bone && ['bonezone', 'bonerzoner'].includes(ability)) {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Bone <small>(affected by Bone Zone)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif ((move.recoil || move.hasCrashDamage) && ability === 'reckless') {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Recoil <small>(boosted by Reckless)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.bullet) {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Bullet-like <small>(doesn't affect Bulletproof pokemon)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.slicing) {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Slicing <small>(boosted by Sharpness and Blademaster)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.wind) {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Wind <small>(activates Wind Power and Wind Rider)</small></p>`;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\r\n\t/**\r\n\t * Needs either a Pokemon or a ServerPokemon, but note that neither\r\n\t * are guaranteed: If you hover over a possible switch-in that's\r\n\t * never been switched in before, you'll only have a ServerPokemon,\r\n\t * and if you hover over an opponent's pokemon, you'll only have a\r\n\t * Pokemon.\r\n\t *\r\n\t * isActive is true if hovering over a pokemon in the battlefield,\r\n\t * and false if hovering over a pokemon in the Switch menu.\r\n\t *\r\n\t * @param clientPokemon\r\n\t * @param serverPokemon\r\n\t * @param isActive\r\n\t */\r\n\tshowPokemonTooltip(\r\n\t\tclientPokemon: Pokemon | null, serverPokemon?: ServerPokemon | null, isActive?: boolean, illusionIndex?: number\r\n\t) {\r\n\t\tconst pokemon = clientPokemon || serverPokemon!;\r\n\t\tlet text = '';\r\n\t\tlet genderBuf = '';\r\n\t\tconst gender = pokemon.gender;\r\n\t\tif (gender === 'M' || gender === 'F') {\r\n\t\t\tgenderBuf = ` <img src=\"${Dex.fxPrefix}gender-${gender.toLowerCase()}.png\" alt=\"${gender}\" width=\"7\" height=\"10\" class=\"pixelated\" /> `;\r\n\t\t}\r\n\r\n\t\tlet name = BattleLog.escapeHTML(pokemon.name);\r\n\t\tif (pokemon.speciesForme !== pokemon.name) {\r\n\t\t\tname += ' <small>(' + BattleLog.escapeHTML(pokemon.speciesForme) + ')</small>';\r\n\t\t}\r\n\r\n\t\tlet levelBuf = (pokemon.level !== 100 ? ` <small>L${pokemon.level}</small>` : ``);\r\n\t\tif (!illusionIndex || illusionIndex === 1) {\r\n\t\t\ttext += `<h2>${name}${genderBuf}${illusionIndex ? '' : levelBuf}<br />`;\r\n\r\n\t\t\tif (clientPokemon?.volatiles.formechange) {\r\n\t\t\t\tif (clientPokemon.volatiles.transform) {\r\n\t\t\t\t\ttext += `<small>(Transformed into ${clientPokemon.volatiles.formechange[1]})</small><br />`;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttext += `<small>(Changed forme: ${clientPokemon.volatiles.formechange[1]})</small><br />`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet types = serverPokemon?.terastallized ? [serverPokemon.teraType] : this.getPokemonTypes(pokemon);\r\n\t\t\tlet knownPokemon = serverPokemon || clientPokemon!;\r\n\r\n\t\t\tif (pokemon.terastallized) {\r\n\t\t\t\ttext += `<small>(Terastallized)</small><br />`;\r\n\t\t\t} else if (clientPokemon?.volatiles.typechange || clientPokemon?.volatiles.typeadd) {\r\n\t\t\t\ttext += `<small>(Type changed)</small><br />`;\r\n\t\t\t}\r\n\t\t\ttext += `<span class=\"textaligned-typeicons\">${types.map(type => Dex.getTypeIcon(type)).join(' ')}</span>`;\r\n\t\t\tif (pokemon.terastallized) {\r\n\t\t\t\ttext += `&nbsp; &nbsp; <small>(base: <span class=\"textaligned-typeicons\">${this.getPokemonTypes(pokemon, true).map(type => Dex.getTypeIcon(type)).join(' ')}</span>)</small>`;\r\n\t\t\t} else if (knownPokemon.teraType && !this.battle.rules['Terastal Clause']) {\r\n\t\t\t\ttext += `&nbsp; &nbsp; <small>(Tera Type: <span class=\"textaligned-typeicons\">${Dex.getTypeIcon(knownPokemon.teraType)}</span>)</small>`;\r\n\t\t\t}\r\n\t\t\ttext += `</h2>`;\r\n\t\t}\r\n\r\n\t\tif (illusionIndex) {\r\n\t\t\ttext += `<p class=\"section\"><strong>Possible Illusion #${illusionIndex}</strong>${levelBuf}</p>`;\r\n\t\t}\r\n\r\n\t\tif (pokemon.fainted) {\r\n\t\t\ttext += '<p><small>HP:</small> (fainted)</p>';\r\n\t\t} else if (this.battle.hardcoreMode) {\r\n\t\t\tif (serverPokemon) {\r\n\t\t\t\ttext += '<p><small>HP:</small> ' + serverPokemon.hp + '/' + serverPokemon.maxhp + (pokemon.status ? ' <span class=\"status ' + pokemon.status + '\">' + pokemon.status.toUpperCase() + '</span>' : '') + '</p>';\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlet exacthp = '';\r\n\t\t\tif (serverPokemon) {\r\n\t\t\t\texacthp = ' (' + serverPokemon.hp + '/' + serverPokemon.maxhp + ')';\r\n\t\t\t} else if (pokemon.maxhp === 48) {\r\n\t\t\t\texacthp = ' <small>(' + pokemon.hp + '/' + pokemon.maxhp + ' pixels)</small>';\r\n\t\t\t}\r\n\t\t\ttext += '<p><small>HP:</small> ' + Pokemon.getHPText(pokemon) + exacthp + (pokemon.status ? ' <span class=\"status ' + pokemon.status + '\">' + pokemon.status.toUpperCase() + '</span>' : '');\r\n\t\t\tif (clientPokemon) {\r\n\t\t\t\tif (pokemon.status === 'tox') {\r\n\t\t\t\t\tif (pokemon.ability === 'Poison Heal' || pokemon.ability === 'Magic Guard') {\r\n\t\t\t\t\t\ttext += ' <small>Would take if ability removed: ' + Math.floor(100 / 16 * Math.min(clientPokemon.statusData.toxicTurns + 1, 15)) + '%</small>';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttext += ' Next damage: ' + Math.floor(100 / (clientPokemon.volatiles['dynamax'] ? 32 : 16) * Math.min(clientPokemon.statusData.toxicTurns + 1, 15)) + '%';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (pokemon.status === 'slp') {\r\n\t\t\t\t\ttext += ' Turns asleep: ' + clientPokemon.statusData.sleepTurns;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ttext += '</p>';\r\n\t\t}\r\n\r\n\t\tconst supportsAbilities = this.battle.gen > 2 && !this.battle.tier.includes(\"Let's Go\");\r\n\r\n\t\tlet abilityText = '';\r\n\t\tif (supportsAbilities) {\r\n\t\t\tabilityText = this.getPokemonAbilityText(\r\n\t\t\t\tclientPokemon, serverPokemon, isActive, !!illusionIndex && illusionIndex > 1\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tlet itemText = '';\r\n\t\tif (serverPokemon) {\r\n\t\t\tlet item = '';\r\n\t\t\tlet itemEffect = '';\r\n\t\t\tif (clientPokemon?.prevItem) {\r\n\t\t\t\titem = 'None';\r\n\t\t\t\tlet prevItem = this.battle.dex.items.get(clientPokemon.prevItem).name;\r\n\t\t\t\titemEffect += clientPokemon.prevItemEffect ? prevItem + ' was ' + clientPokemon.prevItemEffect : 'was ' + prevItem;\r\n\t\t\t}\r\n\t\t\tif (serverPokemon.item) item = this.battle.dex.items.get(serverPokemon.item).name;\r\n\t\t\tif (itemEffect) itemEffect = ' (' + itemEffect + ')';\r\n\t\t\tif (item) itemText = '<small>Item:</small> ' + item + itemEffect;\r\n\t\t} else if (clientPokemon) {\r\n\t\t\tlet item = '';\r\n\t\t\tlet itemEffect = clientPokemon.itemEffect || '';\r\n\t\t\tif (clientPokemon.prevItem) {\r\n\t\t\t\titem = 'None';\r\n\t\t\t\tif (itemEffect) itemEffect += '; ';\r\n\t\t\t\tlet prevItem = this.battle.dex.items.get(clientPokemon.prevItem).name;\r\n\t\t\t\titemEffect += clientPokemon.prevItemEffect ? prevItem + ' was ' + clientPokemon.prevItemEffect : 'was ' + prevItem;\r\n\t\t\t}\r\n\t\t\tif (pokemon.item) item = this.battle.dex.items.get(pokemon.item).name;\r\n\t\t\tif (itemEffect) itemEffect = ' (' + itemEffect + ')';\r\n\t\t\tif (item) itemText = '<small>Item:</small> ' + item + itemEffect;\r\n\t\t}\r\n\r\n\t\tif (abilityText || itemText) {\r\n\t\t\ttext += '<p>';\r\n\t\t\ttext += abilityText;\r\n\t\t\tif (abilityText && itemText) {\r\n\t\t\t\t// ability/item on one line for your own switch tooltips, two lines everywhere else\r\n\t\t\t\ttext += (!isActive && serverPokemon ? ' / ' : '</p><p>');\r\n\t\t\t}\r\n\t\t\ttext += itemText;\r\n\t\t\ttext += '</p>';\r\n\t\t}\r\n\r\n\t\ttext += this.renderStats(clientPokemon, serverPokemon, !isActive);\r\n\r\n\t\tif (serverPokemon && !isActive) {\r\n\t\t\t// move list\r\n\t\t\ttext += `<p class=\"section\">`;\r\n\t\t\tconst battlePokemon = clientPokemon || this.battle.findCorrespondingPokemon(pokemon);\r\n\t\t\tfor (const moveid of serverPokemon.moves) {\r\n\t\t\t\tconst move = this.battle.dex.moves.get(moveid);\r\n\t\t\t\tlet moveName = `&#8226; ${move.name}`;\r\n\t\t\t\tif (battlePokemon?.moveTrack) {\r\n\t\t\t\t\tfor (const row of battlePokemon.moveTrack) {\r\n\t\t\t\t\t\tif (moveName === row[0]) {\r\n\t\t\t\t\t\t\tmoveName = this.getPPUseText(row, true);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ttext += `${moveName}<br />`;\r\n\t\t\t}\r\n\t\t\ttext += '</p>';\r\n\t\t} else if (!this.battle.hardcoreMode && clientPokemon?.moveTrack.length) {\r\n\t\t\t// move list (guessed)\r\n\t\t\ttext += `<p class=\"section\">`;\r\n\t\t\tfor (const row of clientPokemon.moveTrack) {\r\n\t\t\t\ttext += `${this.getPPUseText(row)}<br />`;\r\n\t\t\t}\r\n\t\t\tif (clientPokemon.moveTrack.filter(([moveName]) => {\r\n\t\t\t\tif (moveName.charAt(0) === '*') return false;\r\n\t\t\t\tconst move = this.battle.dex.moves.get(moveName);\r\n\t\t\t\treturn !move.isZ && !move.isMax && move.name !== 'Mimic';\r\n\t\t\t}).length > 4) {\r\n\t\t\t\ttext += `(More than 4 moves is usually a sign of Illusion Zoroark/Zorua.) `;\r\n\t\t\t}\r\n\t\t\tif (this.battle.gen === 3) {\r\n\t\t\t\ttext += `(Pressure is not visible in Gen 3, so in certain situations, more PP may have been lost than shown here.) `;\r\n\t\t\t}\r\n\t\t\tif (this.pokemonHasClones(clientPokemon)) {\r\n\t\t\t\ttext += `(Your opponent has two indistinguishable Pokémon, making it impossible for you to tell which one has which moves/ability/item.) `;\r\n\t\t\t}\r\n\t\t\ttext += `</p>`;\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\r\n\tshowFieldTooltip() {\r\n\t\tconst scene = this.battle.scene as BattleScene;\r\n\t\tlet buf = `<table style=\"border: 0; border-collapse: collapse; vertical-align: top; padding: 0; width: 100%\"><tr>`;\r\n\r\n\t\tlet atLeastOne = false;\r\n\t\tfor (const side of this.battle.sides) {\r\n\t\t\tconst sideConditions = scene.sideConditionsLeft(side, true);\r\n\t\t\tif (sideConditions) atLeastOne = true;\r\n\t\t\tbuf += `<td><p class=\"section\"><strong>${BattleLog.escapeHTML(side.name)}</strong>${sideConditions || \"<br />(no conditions)\"}</p></td>`;\r\n\t\t}\r\n\t\tbuf += `</tr><table>`;\r\n\t\tif (!atLeastOne) buf = ``;\r\n\r\n\t\tlet weatherbuf = scene.weatherLeft() || `(no weather)`;\r\n\t\tif (weatherbuf.startsWith('<br />')) {\r\n\t\t\tweatherbuf = weatherbuf.slice(6);\r\n\t\t}\r\n\t\tbuf = `<p>${weatherbuf}</p>` + buf;\r\n\t\treturn `<p>${buf}</p>`;\r\n\t}\r\n\r\n\t/**\r\n\t * Does this Pokémon's trainer have two of these Pokémon that are\r\n\t * indistinguishable? (Same nickname, species, forme, level, gender,\r\n\t * and shininess.)\r\n\t */\r\n\tpokemonHasClones(pokemon: Pokemon) {\r\n\t\tconst side = pokemon.side;\r\n\t\tif (side.battle.speciesClause) return false;\r\n\t\tfor (const ally of side.pokemon) {\r\n\t\t\tif (pokemon !== ally && pokemon.searchid === ally.searchid) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcalculateModifiedStats(clientPokemon: Pokemon | null, serverPokemon: ServerPokemon, statStagesOnly?: boolean) {\r\n\t\tlet stats = {...serverPokemon.stats};\r\n\t\tlet pokemon = clientPokemon || serverPokemon;\r\n\t\tconst isPowerTrick = clientPokemon?.volatiles['powertrick'];\r\n\t\tfor (const statName of Dex.statNamesExceptHP) {\r\n\t\t\tlet sourceStatName = statName;\r\n\t\t\tif (isPowerTrick) {\r\n\t\t\t\tif (statName === 'atk') sourceStatName = 'def';\r\n\t\t\t\tif (statName === 'def') sourceStatName = 'atk';\r\n\t\t\t}\r\n\t\t\tstats[statName] = serverPokemon.stats[sourceStatName];\r\n\t\t\tif (!clientPokemon) continue;\r\n\r\n\t\t\tconst clientStatName = clientPokemon.boosts.spc && (statName === 'spa' || statName === 'spd') ? 'spc' : statName;\r\n\t\t\tconst boostLevel = clientPokemon.boosts[clientStatName];\r\n\t\t\tif (boostLevel) {\r\n\t\t\t\tlet boostTable = [1, 1.5, 2, 2.5, 3, 3.5, 4];\r\n\t\t\t\tif (boostLevel > 0) {\r\n\t\t\t\t\tstats[statName] *= boostTable[boostLevel];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (this.battle.gen <= 2) boostTable = [1, 100 / 66, 2, 2.5, 100 / 33, 100 / 28, 4];\r\n\t\t\t\t\tstats[statName] /= boostTable[-boostLevel];\r\n\t\t\t\t}\r\n\t\t\t\tstats[statName] = Math.floor(stats[statName]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (statStagesOnly) return stats;\r\n\r\n\t\tconst ability = toID(\r\n\t\t\tclientPokemon?.effectiveAbility(serverPokemon) ?? (serverPokemon.ability || serverPokemon.baseAbility)\r\n\t\t);\r\n\r\n\t\t// check for burn, paralysis, guts, quick feet\r\n\t\tif (pokemon.status) {\r\n\t\t\tif (this.battle.gen > 2 && ability === 'guts') {\r\n\t\t\t\tstats.atk = Math.floor(stats.atk * 1.5);\r\n\t\t\t} else if (ability === 'flareheal') {\r\n\t\t\t\t// Skip modification for flare heal\r\n\t\t\t} else if (this.battle.gen < 2 && pokemon.status === 'brn') {\r\n\t\t\t\tstats.atk = Math.floor(stats.atk * 0.5);\r\n\t\t\t}\r\n\r\n\t\t\tif (this.battle.gen > 2 && ability === 'quickfeet') {\r\n\t\t\t\tstats.spe = Math.floor(stats.spe * 1.5);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// gen 1 doesn't support items\r\n\t\tif (this.battle.gen <= 1) {\r\n\t\t\tfor (const statName of Dex.statNamesExceptHP) {\r\n\t\t\t\tif (stats[statName] > 999) stats[statName] = 999;\r\n\t\t\t}\r\n\t\t\treturn stats;\r\n\t\t}\r\n\r\n\t\tlet item = toID(serverPokemon.item);\r\n\t\tlet speedHalvingEVItems = ['machobrace', 'poweranklet', 'powerband', 'powerbelt', 'powerbracer', 'powerlens', 'powerweight'];\r\n\t\tif (\r\n\t\t\t(ability === 'klutz' && !speedHalvingEVItems.includes(item)) ||\r\n\t\t\tthis.battle.hasPseudoWeather('Magic Room') ||\r\n\t\t\tclientPokemon?.volatiles['embargo']\r\n\t\t) {\r\n\t\t\titem = '' as ID;\r\n\t\t}\r\n\r\n\t\tconst species = this.battle.dex.species.get(serverPokemon.speciesForme).baseSpecies;\r\n\t\tconst isTransform = clientPokemon?.volatiles.transform;\r\n\t\tconst speciesName = isTransform && clientPokemon?.volatiles.formechange?.[1] && this.battle.gen <= 4 ?\r\n\t\t\tthis.battle.dex.species.get(clientPokemon.volatiles.formechange[1]).baseSpecies : species;\r\n\r\n\t\tlet speedModifiers = [];\r\n\r\n\t\t// check for light ball, thick club, metal/quick powder\r\n\t\t// the only stat modifying items in gen 2 were light ball, thick club, metal powder\r\n\t\tif (item === 'lightball') {\r\n\t\t\tif (species === 'Pikachu' || species === 'Ampstar') {\r\n\t\t\t\tif (this.battle.gen >= 4) stats.atk *= 2;\r\n\t\t\t\tstats.spa *= 2;\r\n\t\t\t} else if (species === 'Pikotton') {\r\n\t\t\t\tstats.spa *= 2;\r\n\t\t\t} else if (speciesName === 'Blobbos-Pika') {\r\n\t\t\t\tstats.atk *= 2;\r\n\t\t\t\tstats.spa *= 2;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (item === 'thickclub') {\r\n\t\t\tif (speciesName === 'Marowak' || speciesName === 'Cubone') {\r\n\t\t\t\tstats.atk *= 2;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (item === 'thiccbone') {\r\n\t\t\tif (species === 'Masdawg' || species === 'Pasdawg' || species === 'Bandicute' || species === 'Naughtycoot') {\r\n\t\t\t\tstats.atk *= 2;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (item === 'magicianswand') {\r\n\t\t\tif (species === 'Bitician' || species === 'Mysticket') {\r\n\t\t\t\tstats.spa *= 2;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\r\n\t\tif (item === 'cursedfang' && species === 'Winkhulu') {\r\n\t\t\tstats.atk *= 2;\r\n\t\t}\r\n\r\n\t\tif (item === 'crimsonlens' && species === 'Winkhulu') {\r\n\t\t\tstats.spa *= 2;\r\n\t\t}\r\n\r\n\t\tif (item === 'bigfaggot' && species === 'Flameboyan') {\r\n\t\t\tstats.spa *= 2;\r\n\t\t}\r\n\r\n\t\tif (item === 'baconstrip' && species === 'Urswine') {\r\n\t\t\tstats.spd *= 2;\r\n\t\t}\r\n\r\n\t\tif (item === 'suedeshoes' && species === 'Pretzely') {\r\n\t\t\tstats.spe *= 2;\r\n\t\t}\r\n\r\n\t\tif (speciesName === 'Ditto' && !(clientPokemon && 'transform' in clientPokemon.volatiles)) {\r\n\t\t\tif (item === 'quickpowder') {\r\n\t\t\t\tspeedModifiers.push(2);\r\n\t\t\t}\r\n\t\t\tif (item === 'metalpowder') {\r\n\t\t\t\tif (this.battle.gen === 2) {\r\n\t\t\t\t\tstats.def = Math.floor(stats.def * 1.5);\r\n\t\t\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tstats.def *= 2;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// check abilities other than Guts and Quick Feet\r\n\t\t// check items other than light ball, thick club, metal/quick powder\r\n\t\tif (this.battle.gen <= 2) {\r\n\t\t\treturn stats;\r\n\t\t}\r\n\r\n\t\tlet weather = this.battle.weather;\r\n\t\tif (this.battle.abilityActive(['Air Lock', 'Cloud Nine'])) {\r\n\t\t\tweather = '' as ID;\r\n\t\t}\r\n\r\n\t\tif (item === 'choiceband' && !clientPokemon?.volatiles['dynamax']) {\r\n\t\t\tstats.atk = Math.floor(stats.atk * 1.5);\r\n\t\t}\r\n\t\tif (ability === 'purepower' || ability === 'hugepower') {\r\n\t\t\tstats.atk *= 2;\r\n\t\t}\r\n\t\tif (ability === 'brainpower') {\r\n\t\t\tstats.spa *= 2;\r\n\t\t}\r\n\t\tif (ability === 'hunter') {\r\n\t\t\tstats.spe *= 2;\r\n\t\t\tstats.def *= 0.5;\r\n\t\t\tstats.spd *= 0.5;\r\n\t\t}\r\n\t\tif (ability === 'asoneblobbos') {\r\n\t\t\tstats.atk *= 4;\r\n\t\t}\r\n\t\tif (item === 'tumultuoustibia') {\r\n\t\t\tif (speciesName === 'Blobbos-Skeleton') {\r\n\t\t\t\tstats.atk *= 2;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (item === 'usbdrive') {\r\n\t\t\tif (speciesName === 'Blobbos-Idiot') {\r\n\t\t\t\tstats.spa *= 2;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (item === 'mascotsorb') {\r\n\t\t\tif (speciesName === 'Blobbos-Pika') {\r\n\t\t\t\tstats.atk *= 2;\r\n\t\t\t\tstats.spa *= 2;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (item === 'vortexorb' && serverPokemon.hp <= serverPokemon.maxhp / 2) {\r\n\t\t\tstats.spe = Math.floor(stats.spe * 2);\r\n\t\t\tstats.spa = Math.floor(stats.spa * 2);\r\n\t\t}\r\n\t\tif (item === 'partnerspendant') {\r\n\t\t\tif (speciesName === 'Blobbos-Partner') {\r\n\t\t\t\tstats.atk *= 1.5;\r\n\t\t\t\tstats.spa *= 1.5;\r\n\t\t\t\tstats.spe *= 1.5;\r\n\t\t\t\tstats.def *= 1.5;\r\n\t\t\t\tstats.spd *= 1.5;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (ability === 'hustle' || (ability === 'gorillatactics' && !clientPokemon?.volatiles['dynamax']) || (ability === 'boardpowerv')) {\r\n\t\t\tstats.atk = Math.floor(stats.atk * 1.5);\r\n\t\t}\r\n\t\tif (weather) {\r\n\t\t\tif (this.battle.gen >= 4 && this.pokemonHasType(pokemon, 'Rock') && weather === 'sandstorm') {\r\n\t\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t\t}\r\n\t\t\tif (this.pokemonHasType(pokemon, 'Ice') && weather === 'snow') {\r\n\t\t\t\tstats.def = Math.floor(stats.def * 1.5);\r\n\t\t\t}\r\n\t\t\tif (ability === 'sandrush' && weather === 'sandstorm') {\r\n\t\t\t\tspeedModifiers.push(2);\r\n\t\t\t}\r\n\t\t\tif (ability === 'slushrush' && (weather === 'hail' || weather === 'snow')) {\r\n\t\t\t\tspeedModifiers.push(2);\r\n\t\t\t}\r\n\t\t\tif (item !== 'utilityumbrella') {\r\n\t\t\t\tif (weather === 'sunnyday' || weather === 'desolateland') {\r\n\t\t\t\t\tif (ability === 'chlorophyll') {\r\n\t\t\t\t\t\tspeedModifiers.push(2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (ability === 'solarpower') {\r\n\t\t\t\t\t\tstats.spa = Math.floor(stats.spa * 1.5);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (ability === 'orichalcumpulse') {\r\n\t\t\t\t\t\tstats.atk = Math.floor(stats.atk * 1.3);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet allyActive = clientPokemon?.side.active;\r\n\t\t\t\t\tif (allyActive) {\r\n\t\t\t\t\t\tfor (const ally of allyActive) {\r\n\t\t\t\t\t\t\tif (!ally || ally.fainted) continue;\r\n\t\t\t\t\t\t\tlet allyAbility = this.getAllyAbility(ally);\r\n\t\t\t\t\t\t\tif (allyAbility === 'Flower Gift' && (ally.getSpecies().baseSpecies === 'Cherrim' || this.battle.gen <= 4)) {\r\n\t\t\t\t\t\t\t\tstats.atk = Math.floor(stats.atk * 1.5);\r\n\t\t\t\t\t\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (weather === 'raindance' || weather === 'primordialsea') {\r\n\t\t\t\t\tif (ability === 'swiftswim') {\r\n\t\t\t\t\t\tspeedModifiers.push(2);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (ability === 'defeatist' && serverPokemon.hp <= serverPokemon.maxhp / 2) {\r\n\t\t\tstats.atk = Math.floor(stats.atk * 0.5);\r\n\t\t\tstats.spa = Math.floor(stats.spa * 0.5);\r\n\t\t}\r\n\t\tif (clientPokemon) {\r\n\t\t\tif (clientPokemon.volatiles['slowstart']) {\r\n\t\t\t\tstats.atk = Math.floor(stats.atk * 0.5);\r\n\t\t\t\tspeedModifiers.push(0.5);\r\n\t\t\t}\r\n\t\t\tif (ability === 'unburden' && clientPokemon.volatiles['itemremoved'] && !item) {\r\n\t\t\t\tspeedModifiers.push(2);\r\n\t\t\t}\r\n\t\t\tfor (const statName of Dex.statNamesExceptHP) {\r\n\t\t\t\tif (clientPokemon.volatiles['protosynthesis' + statName] || clientPokemon.volatiles['quarkdrive' + statName]) {\r\n\t\t\t\t\tif (statName === 'spe') {\r\n\t\t\t\t\t\tspeedModifiers.push(1.5);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tstats[statName] = Math.floor(stats[statName] * 1.3);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (ability === 'marvelscale' && pokemon.status) {\r\n\t\t\tstats.def = Math.floor(stats.def * 1.5);\r\n\t\t}\r\n\t\tconst isNFE = this.battle.dex.species.get(serverPokemon.speciesForme).evos?.some(evo => {\r\n\t\t\tconst evoSpecies = this.battle.dex.species.get(evo);\r\n\t\t\treturn !evoSpecies.isNonstandard ||\r\n\t\t\t\t\tevoSpecies.isNonstandard === this.battle.dex.species.get(serverPokemon.speciesForme)?.isNonstandard ||\r\n\t\t\t\t\t// Pokemon with Hisui evolutions\r\n\t\t\t\t\tevoSpecies.isNonstandard === \"Unobtainable\";\r\n\t\t});\r\n\t\tif (item === 'eviolite' && (isNFE || this.battle.dex.species.get(serverPokemon.speciesForme).id === 'dipplin')) {\r\n\t\t\tstats.def = Math.floor(stats.def * 1.5);\r\n\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t}\r\n\t\tif (item === 'skub') {\r\n\t\t\tif (speciesName === 'Skub') {\r\n\t\t\t\tstats.def *= 1.5;\r\n\t\t\t\tstats.spd *= 1.5;\r\n\t\t\t} else if (speciesName === 'Skub-Anti') {\r\n\t\t\t\tstats.atk *= 1.5;\r\n\t\t\t\tstats.spa *= 1.5;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (ability === 'grasspelt' && this.battle.hasPseudoWeather('Grassy Terrain')) {\r\n\t\t\tstats.def = Math.floor(stats.def * 1.5);\r\n\t\t}\r\n\t\tif (this.battle.hasPseudoWeather('Electric Terrain')) {\r\n\t\t\tif (ability === 'surgesurfer') {\r\n\t\t\t\tspeedModifiers.push(2);\r\n\t\t\t}\r\n\t\t\tif (ability === 'hadronengine') {\r\n\t\t\t\tstats.spa = Math.floor(stats.spa * 1.3);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (item === 'choicespecs' && !clientPokemon?.volatiles['dynamax']) {\r\n\t\t\tstats.spa = Math.floor(stats.spa * 1.5);\r\n\t\t}\r\n\t\tif (item === 'deepseatooth' && species === 'Clamperl') {\r\n\t\t\tstats.spa *= 2;\r\n\t\t}\r\n\t\tif (item === 'souldew' && this.battle.gen <= 6 && (species === 'Latios' || species === 'Latias')) {\r\n\t\t\tstats.spa = Math.floor(stats.spa * 1.5);\r\n\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t}\r\n\t\tif (clientPokemon && (ability === 'plus' || ability === 'minus')) {\r\n\t\t\tlet allyActive = clientPokemon.side.active;\r\n\t\t\tif (allyActive.length > 1) {\r\n\t\t\t\tlet abilityName = (ability === 'plus' ? 'Plus' : 'Minus');\r\n\t\t\t\tfor (const ally of allyActive) {\r\n\t\t\t\t\tif (!ally || ally === clientPokemon || ally.fainted) continue;\r\n\t\t\t\t\tlet allyAbility = this.getAllyAbility(ally);\r\n\t\t\t\t\tif (allyAbility !== 'Plus' && allyAbility !== 'Minus') continue;\r\n\t\t\t\t\tif (this.battle.gen <= 4 && allyAbility === abilityName) continue;\r\n\t\t\t\t\tstats.spa = Math.floor(stats.spa * 1.5);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (item === 'assaultvest') {\r\n\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t}\r\n\t\tif (item === 'deepseascale' && species === 'Clamperl') {\r\n\t\t\tstats.spd *= 2;\r\n\t\t}\r\n\t\tif (item === 'choicescarf' && !clientPokemon?.volatiles['dynamax']) {\r\n\t\t\tspeedModifiers.push(1.5);\r\n\t\t}\r\n\t\tif (item === 'ironball' || speedHalvingEVItems.includes(item)) {\r\n\t\t\tspeedModifiers.push(0.5);\r\n\t\t}\r\n\t\tif (ability === 'furcoat') {\r\n\t\t\tstats.def *= 2;\r\n\t\t}\r\n\t\tif (this.battle.abilityActive('Vessel of Ruin')) {\r\n\t\t\tif (ability !== 'vesselofruin') {\r\n\t\t\t\tstats.spa = Math.floor(stats.spa * 0.75);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.battle.abilityActive('Sword of Ruin')) {\r\n\t\t\tif (ability !== 'swordofruin') {\r\n\t\t\t\tstats.def = Math.floor(stats.def * 0.75);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.battle.abilityActive('Tablets of Ruin')) {\r\n\t\t\tif (ability !== 'tabletsofruin') {\r\n\t\t\t\tstats.atk = Math.floor(stats.atk * 0.75);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.battle.abilityActive('Beads of Ruin')) {\r\n\t\t\tif (ability !== 'beadsofruin') {\r\n\t\t\t\tstats.spd = Math.floor(stats.spd * 0.75);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst sideConditions = this.battle.mySide.sideConditions;\r\n\t\tif (sideConditions['tailwind']) {\r\n\t\t\tspeedModifiers.push(2);\r\n\t\t}\r\n\t\tif (sideConditions['backdraft']) {\r\n\t\t\tspeedModifiers.push(2);\r\n\t\t}\r\n\t\tif (sideConditions['grasspledge']) {\r\n\t\t\tspeedModifiers.push(0.25);\r\n\t\t}\r\n\t\tif (sideConditions['maplewarrior']) {\r\n\t\t\tspeedModifiers.push(1.2);\r\n\t\t}\r\n\r\n\t\tlet chainedSpeedModifier = 1;\r\n\t\tfor (const modifier of speedModifiers) {\r\n\t\t\tchainedSpeedModifier *= modifier;\r\n\t\t}\r\n\t\t// Chained modifiers round down on 0.5\r\n\t\tstats.spe = stats.spe * chainedSpeedModifier;\r\n\t\tstats.spe = stats.spe % 1 > 0.5 ? Math.ceil(stats.spe) : Math.floor(stats.spe);\r\n\r\n\t\tif (pokemon.status === 'par' && ability !== 'quickfeet') {\r\n\t\t\tif (this.battle.gen > 6) {\r\n\t\t\t\tstats.spe = Math.floor(stats.spe * 0.5);\r\n\t\t\t} else {\r\n\t\t\t\tstats.spe = Math.floor(stats.spe * 0.25);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (clientPokemon?.volatiles['agile']) {\r\n\t\t\tstats.spe = Math.floor(stats.spe * 1.25);\r\n\t\t} else if (clientPokemon?.volatiles['strong']) {\r\n\t\t\tstats.spe = Math.floor(stats.spe * 0.75);\r\n\t\t}\r\n\r\n\t\tif (clientPokemon?.volatiles['colorboost']) {\r\n\t\t\tstats.atk = Math.floor(stats.atk * 1.25);\r\n\t\t}\r\n\r\n\t\t/** Wack item additions */\r\n\r\n\t\tif (item === 'choicecloak' && !clientPokemon?.volatiles['dynamax']) {\r\n\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t}\r\n\t\tif (item === 'choicejacket' && !clientPokemon?.volatiles['dynamax']) {\r\n\t\t\tstats.def = Math.floor(stats.def * 1.5);\r\n\t\t}\r\n\r\n\t\tif (item === 'eviolate' && isNFE) {\r\n\t\t\tstats.atk = Math.floor(stats.atk * 1.5);\r\n\t\t\tstats.spa = Math.floor(stats.spa * 1.5);\r\n\t\t}\r\n\r\n\t\tif (item === 'eviocicle' && isNFE) {\r\n\t\t\tstats.spe = Math.floor(stats.spe * 1.5);\r\n\t\t}\r\n\r\n\t\treturn stats;\r\n\t}\r\n\r\n\trenderStats(clientPokemon: Pokemon | null, serverPokemon?: ServerPokemon | null, short?: boolean) {\r\n\t\tconst isTransformed = clientPokemon?.volatiles.transform;\r\n\t\tif (!serverPokemon || isTransformed) {\r\n\t\t\tif (!clientPokemon) throw new Error('Must pass either clientPokemon or serverPokemon');\r\n\t\t\tlet [min, max] = this.getSpeedRange(clientPokemon);\r\n\t\t\treturn '<p><small>Spe</small> ' + min + ' to ' + max + ' <small>(before items/abilities/modifiers)</small></p>';\r\n\t\t}\r\n\t\tconst stats = serverPokemon.stats;\r\n\t\tconst modifiedStats = this.calculateModifiedStats(clientPokemon, serverPokemon);\r\n\r\n\t\tlet buf = '<p>';\r\n\r\n\t\tif (!short) {\r\n\t\t\tlet hasModifiedStat = false;\r\n\t\t\tfor (const statName of Dex.statNamesExceptHP) {\r\n\t\t\t\tif (this.battle.gen === 1 && statName === 'spd') continue;\r\n\t\t\t\tlet statLabel = this.battle.gen === 1 && statName === 'spa' ? 'spc' : statName;\r\n\t\t\t\tbuf += statName === 'atk' ? '<small>' : '<small> / ';\r\n\t\t\t\tbuf += '' + BattleText[statLabel].statShortName + '&nbsp;</small>';\r\n\t\t\t\tbuf += '' + stats[statName];\r\n\t\t\t\tif (modifiedStats[statName] !== stats[statName]) hasModifiedStat = true;\r\n\t\t\t}\r\n\t\t\tbuf += '</p>';\r\n\r\n\t\t\tif (!hasModifiedStat) return buf;\r\n\r\n\t\t\tbuf += '<p><small>(After stat modifiers:)</small></p>';\r\n\t\t\tbuf += '<p>';\r\n\t\t}\r\n\r\n\t\tfor (const statName of Dex.statNamesExceptHP) {\r\n\t\t\tif (this.battle.gen === 1 && statName === 'spd') continue;\r\n\t\t\tlet statLabel = this.battle.gen === 1 && statName === 'spa' ? 'spc' : statName;\r\n\t\t\tbuf += statName === 'atk' ? '<small>' : '<small> / ';\r\n\t\t\tbuf += '' + BattleText[statLabel].statShortName + '&nbsp;</small>';\r\n\t\t\tif (modifiedStats[statName] === stats[statName]) {\r\n\t\t\t\tbuf += '' + modifiedStats[statName];\r\n\t\t\t} else if (modifiedStats[statName] < stats[statName]) {\r\n\t\t\t\tbuf += '<strong class=\"stat-lowered\">' + modifiedStats[statName] + '</strong>';\r\n\t\t\t} else {\r\n\t\t\t\tbuf += '<strong class=\"stat-boosted\">' + modifiedStats[statName] + '</strong>';\r\n\t\t\t}\r\n\t\t}\r\n\t\tbuf += '</p>';\r\n\t\treturn buf;\r\n\t}\r\n\r\n\tgetPPUseText(moveTrackRow: [string, number], showKnown?: boolean) {\r\n\t\tlet [moveName, ppUsed] = moveTrackRow;\r\n\t\tlet move;\r\n\t\tlet maxpp;\r\n\t\tif (moveName.charAt(0) === '*') {\r\n\t\t\t// Transformed move\r\n\t\t\tmove = this.battle.dex.moves.get(moveName.substr(1));\r\n\t\t\tmaxpp = 5;\r\n\t\t} else {\r\n\t\t\tmove = this.battle.dex.moves.get(moveName);\r\n\t\t\tmaxpp = (move.pp === 1 || move.noPPBoosts ? move.pp : Math.floor(move.pp * 8 / 5));\r\n\t\t\tif (this.battle.gen < 3) maxpp = Math.min(61, maxpp);\r\n\t\t}\r\n\t\tconst bullet = moveName.charAt(0) === '*' || move.isZ ? '<span style=\"color:#888\">&#8226;</span>' : '&#8226;';\r\n\t\tif (ppUsed === Infinity) {\r\n\t\t\treturn `${bullet} ${move.name} <small>(0/${maxpp})</small>`;\r\n\t\t}\r\n\t\tif (ppUsed || moveName.charAt(0) === '*') {\r\n\t\t\treturn `${bullet} ${move.name} <small>(${maxpp - ppUsed}/${maxpp})</small>`;\r\n\t\t}\r\n\t\treturn `${bullet} ${move.name} ${showKnown ? ' <small>(revealed)</small>' : ''}`;\r\n\t}\r\n\r\n\tppUsed(move: Move, pokemon: Pokemon) {\r\n\t\tfor (let [moveName, ppUsed] of pokemon.moveTrack) {\r\n\t\t\tif (moveName.charAt(0) === '*') moveName = moveName.substr(1);\r\n\t\t\tif (move.name === moveName) return ppUsed;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Calculates possible Speed stat range of an opponent\r\n\t */\r\n\tgetSpeedRange(pokemon: Pokemon): [number, number] {\r\n\t\tconst tr = Math.trunc || Math.floor;\r\n\t\tconst species = pokemon.getSpecies();\r\n\t\tlet baseSpe = species.baseStats.spe;\r\n\t\tif (this.battle.rules['Scalemons Mod']) {\r\n\t\t\tconst bstWithoutHp = species.bst - species.baseStats.hp;\r\n\t\t\tconst scale = 600 - species.baseStats.hp;\r\n\t\t\tbaseSpe = tr(baseSpe * scale / bstWithoutHp);\r\n\t\t\tif (baseSpe < 1) baseSpe = 1;\r\n\t\t\tif (baseSpe > 255) baseSpe = 255;\r\n\t\t}\r\n\t\tlet level = pokemon.volatiles.transform?.[4] || pokemon.level;\r\n\t\tlet tier = this.battle.tier;\r\n\t\tlet gen = this.battle.gen;\r\n\t\tlet isCGT = tier.includes('Computer-Generated Teams');\r\n\t\tlet isRandomBattle = tier.includes('Random Battle') ||\r\n\t\t\t(tier.includes('Random') && tier.includes('Battle') && gen >= 6) || isCGT;\r\n\r\n\t\tlet minNature = (isRandomBattle || gen < 3) ? 1 : 0.9;\r\n\t\tlet maxNature = (isRandomBattle || gen < 3) ? 1 : 1.1;\r\n\t\tlet maxIv = (gen < 3) ? 30 : 31;\r\n\r\n\t\tlet min;\r\n\t\tlet max;\r\n\t\tif (tier.includes(\"Let's Go\")) {\r\n\t\t\tmin = tr(tr(tr(2 * baseSpe * level / 100 + 5) * minNature) * tr((70 / 255 / 10 + 1) * 100) / 100);\r\n\t\t\tmax = tr(tr(tr((2 * baseSpe + maxIv) * level / 100 + 5) * maxNature) * tr((70 / 255 / 10 + 1) * 100) / 100);\r\n\t\t\tif (tier.includes('No Restrictions')) max += 200;\r\n\t\t\telse if (tier.includes('Random')) max += 20;\r\n\t\t} else {\r\n\t\t\tlet maxIvEvOffset = maxIv + ((isRandomBattle && gen >= 3) ? 21 : 63);\r\n\t\t\tmax = tr(tr((2 * baseSpe + maxIvEvOffset) * level / 100 + 5) * maxNature);\r\n\t\t\tmin = isCGT ? max : tr(tr(2 * baseSpe * level / 100 + 5) * minNature);\r\n\t\t}\r\n\t\treturn [min, max];\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the proper current type for moves with a variable type.\r\n\t */\r\n\tgetMoveType(move: Move, value: ModifiableValue, forMaxMove?: boolean | Move): [TypeName, 'Physical' | 'Special' | 'Status'] {\r\n\t\tconst pokemon = value.pokemon;\r\n\t\tconst serverPokemon = value.serverPokemon;\r\n\r\n\t\tlet moveType = move.type;\r\n\t\tlet category = move.category;\r\n\t\tif (category === 'Status' && forMaxMove) return ['Normal', 'Status']; // Max Guard\r\n\t\t// can happen in obscure situations\r\n\t\tif (!pokemon) return [moveType, category];\r\n\r\n\t\tlet pokemonTypes = pokemon.getTypeList(serverPokemon);\r\n\t\tvalue.reset();\r\n\t\tif (move.id === 'revelationdance' || move.id === 'jacsmack') {\r\n\t\t\tmoveType = pokemonTypes[0];\r\n\t\t}\r\n\t\t// Moves that require an item to change their type.\r\n\t\tlet item = this.battle.dex.items.get(value.itemName);\r\n\t\tif (move.id === 'multiattack' && item.onMemory) {\r\n\t\t\tif (value.itemModify(0)) moveType = item.onMemory;\r\n\t\t}\r\n\t\tif (move.id === 'judgment' && item.onPlate && !item.zMoveType) {\r\n\t\t\tif (value.itemModify(0)) moveType = item.onPlate;\r\n\t\t}\r\n\t\tif (move.id === 'technoblast' && item.onDrive) {\r\n\t\t\tif (value.itemModify(0)) moveType = item.onDrive;\r\n\t\t}\r\n\t\tif (move.id === 'naturalgift' && item.naturalGift) {\r\n\t\t\tif (value.itemModify(0)) moveType = item.naturalGift.type;\r\n\t\t}\r\n\t\tif (category === 'Physical' || category === 'Special') {\r\n\t\t\tswitch (item.id) {\r\n\t\t\tcase 'blooddust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Blood';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'bonedust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Bone';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'bugdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Bug';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'chaosdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Chaos';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'cosmicdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Cosmic';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'crystaldust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Crystal';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'cyberdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Cyber';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'darkdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Dark';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'divinedust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Divine';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'dragondust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Dragon';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'electricdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Electric';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'fabricdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Fabric';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'fairydust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Fairy';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'feardust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Fear';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'fightingdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Fighting';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'firedust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Fire';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'flyingdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Flying';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'fooddust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Food';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'ghostdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Ghost';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'glassdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Glass';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'grassdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Grass';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'greasydust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Greasy';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'grounddust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Ground';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'heartdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Heart';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'icedust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Ice';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'lightdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Light';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'magicdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Magic';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'magmadust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Magma';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'memedust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Meme';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'normaldust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Normal';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'nucleardust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Nuclear';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'ogredust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Ogre';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'paintdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Paint';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'paperdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Paper';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'plasticdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Plastic';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'poisondust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Poison';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'psychicdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Psychic';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'qmarksdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Qmarks';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'rockdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Rock';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'rubberdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Rubber';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'shadowdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Shadow';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'sounddust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Sound';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'steamdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Steam';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'steeldust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Steel';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'techdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Tech';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'timedust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Time';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'virusdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Virus';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'voiddust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Void';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'wackdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Wack';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'waterdust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Water';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'winddust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Wind';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'wooddust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Wood';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'zombiedust':\r\n\t\t\t\tif (value.itemModify(0)) moveType = 'Zombie';\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Weather and pseudo-weather type changes.\r\n\t\tif (move.id === 'weatherball' && value.weatherModify(0)) {\r\n\t\t\tswitch (this.battle.weather) {\r\n\t\t\tcase 'sunnyday':\r\n\t\t\tcase 'desolateland':\r\n\t\t\t\tif (item.id === 'utilityumbrella') break;\r\n\t\t\t\tmoveType = 'Fire';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'raindance':\r\n\t\t\tcase 'primordialsea':\r\n\t\t\t\tif (item.id === 'utilityumbrella') break;\r\n\t\t\t\tmoveType = 'Water';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'sandstorm':\r\n\t\t\t\tmoveType = 'Rock';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'hail':\r\n\t\t\tcase 'snow':\r\n\t\t\t\tmoveType = 'Ice';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'acidrain':\r\n\t\t\t\tmoveType = 'Poison';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'midnight':\r\n\t\t\t\tmoveType = 'Ghost';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'bladerain':\r\n\t\t\t\tmoveType = 'Steel';\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (move.id === 'terrainpulse' && pokemon.isGrounded(serverPokemon)) {\r\n\t\t\tif (this.battle.hasPseudoWeather('Electric Terrain')) {\r\n\t\t\t\tmoveType = 'Electric';\r\n\t\t\t} else if (this.battle.hasPseudoWeather('Grassy Terrain')) {\r\n\t\t\t\tmoveType = 'Grass';\r\n\t\t\t} else if (this.battle.hasPseudoWeather('Misty Terrain')) {\r\n\t\t\t\tmoveType = 'Fairy';\r\n\t\t\t} else if (this.battle.hasPseudoWeather('Psychic Terrain')) {\r\n\t\t\t\tmoveType = 'Psychic';\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (move.id === 'terablast' && pokemon.terastallized) {\r\n\t\t\tmoveType = pokemon.terastallized as TypeName;\r\n\t\t}\r\n\r\n\t\t// Aura Wheel as Morpeko-Hangry changes the type to Dark\r\n\t\tif (move.id === 'aurawheel' && pokemon.getSpeciesForme() === 'Morpeko-Hangry') {\r\n\t\t\tmoveType = 'Dark';\r\n\t\t}\r\n\t\t// Brutal Punishment as Disbeary-Ebil changes the type to Dark\r\n\t\tif (move.id === 'brutalpunishment' && pokemon.getSpeciesForme() === 'Disbeary-Ebil') {\r\n\t\t\tmoveType = 'Dark';\r\n\t\t}\r\n\t\t// Raging Bull's type depends on the Tauros forme\r\n\t\tif (move.id === 'ragingbull') {\r\n\t\t\tswitch (pokemon.getSpeciesForme()) {\r\n\t\t\tcase 'Tauros-Paldea-Combat':\r\n\t\t\t\tmoveType = 'Fighting';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Tauros-Paldea-Blaze':\r\n\t\t\t\tmoveType = 'Fire';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Tauros-Paldea-Aqua':\r\n\t\t\t\tmoveType = 'Water';\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Ivy Cudgel's type depends on the Ogerpon forme\r\n\t\tif (move.id === 'ivycudgel') {\r\n\t\t\tswitch (pokemon.getSpeciesForme()) {\r\n\t\t\tcase 'Ogerpon-Wellspring': case 'Ogerpon-Wellspring-Tera':\r\n\t\t\t\tmoveType = 'Water';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Ogerpon-Hearthflame': case 'Ogerpon-Hearthflame-Tera':\r\n\t\t\t\tmoveType = 'Fire';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Ogerpon-Cornerstone': case 'Ogerpon-Cornerstone-Tera':\r\n\t\t\t\tmoveType = 'Rock';\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Other abilities that change the move type.\r\n\t\tconst noTypeOverride = [\r\n\t\t\t'judgment', 'multiattack', 'naturalgift', 'revelationdance', 'struggle', 'technoblast', 'terrainpulse', 'weatherball',\r\n\t\t];\r\n\r\n\t\tconst allowTypeOverride = !noTypeOverride.includes(move.id) && (move.id !== 'terablast' || !pokemon.terastallized);\r\n\t\tif (allowTypeOverride) {\r\n\t\t\tif (this.battle.rules['Revelationmons Mod']) {\r\n\t\t\t\tconst [types] = pokemon.getTypes(serverPokemon);\r\n\t\t\t\tfor (let i = 0; i < types.length; i++) {\r\n\t\t\t\t\tif (serverPokemon.moves[i] && move.id === toID(serverPokemon.moves[i])) {\r\n\t\t\t\t\t\tmoveType = types[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (category !== 'Status' && !move.isZ && !move.id.startsWith('hiddenpower')) {\r\n\t\t\t\tif (moveType === 'Normal') {\r\n\t\t\t\t\tif (value.abilityModify(0, 'Aerilate')) moveType = 'Flying';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Galvanize')) moveType = 'Electric';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Pixilate')) moveType = 'Fairy';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Refrigerate')) moveType = 'Ice';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Degenerate')) moveType = 'Dark';\r\n\t\t\t\t\tif (value.abilityModify(0, 'He Will Be Dragon')) moveType = 'Dragon';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Windate')) moveType = 'Wind';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Immolate')) moveType = 'Fire';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Magicate')) moveType = 'Magic';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Evaporate')) moveType = 'Steam';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Martialate')) moveType = 'Fighting';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Hydrate')) moveType = 'Water';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Ionate')) moveType = 'Electric';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Thunderstorm')) moveType = 'Electric';\r\n\t\t\t\t}\r\n\t\t\t\tif (value.abilityModify(0, 'Normalize')) moveType = 'Normal';\r\n\t\t\t\tif (value.abilityModify(0, 'Wacky')) moveType = 'Wack';\r\n\t\t\t\tif (move.flags.sound) {\r\n\t\t\t\t\tif (value.abilityModify(0, 'Ghost Note')) moveType = 'Ghost';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// There aren't any max moves with the sound flag, but if there were, Liquid Voice would make them water type\r\n\t\t\tconst isSound = !!(\r\n\t\t\t\tforMaxMove ?\r\n\t\t\t\tthis.getMaxMoveFromType(moveType, forMaxMove !== true && forMaxMove || undefined) : move\r\n\t\t\t).flags['sound'];\r\n\t\t\tif (isSound && value.abilityModify(0, 'Liquid Voice')) {\r\n\t\t\t\tmoveType = 'Water';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (move.id === 'photongeyser' || move.id === 'lightthatburnsthesky' ||\r\n\t\t\tmove.id === 'terablast' && pokemon.terastallized) {\r\n\t\t\tconst stats = this.calculateModifiedStats(pokemon, serverPokemon, true);\r\n\t\t\tif (stats.atk > stats.spa) category = 'Physical';\r\n\t\t}\r\n\t\treturn [moveType, category];\r\n\t}\r\n\r\n\t// Gets the current accuracy for a move.\r\n\tgetMoveAccuracy(move: Move, value: ModifiableValue, target?: Pokemon) {\r\n\t\tvalue.reset(move.accuracy === true ? 0 : move.accuracy, true);\r\n\r\n\t\tlet pokemon = value.pokemon!;\r\n\t\t// Sure-hit accuracy\r\n\t\tif (move.id === 'toxic' && this.battle.gen >= 6 && this.pokemonHasType(pokemon, 'Poison')) {\r\n\t\t\tvalue.set(0, \"Poison type\");\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\tif (move.id === 'blizzard' && this.battle.gen >= 4) {\r\n\t\t\tvalue.weatherModify(0, 'Hail');\r\n\t\t\tvalue.weatherModify(0, 'Snow');\r\n\t\t}\r\n\t\tif (['hurricane', 'thunder', 'bleakwindstorm', 'wildboltstorm', 'sandsearstorm'].includes(move.id)) {\r\n\t\t\tvalue.weatherModify(0, 'Rain Dance');\r\n\t\t\tvalue.weatherModify(0, 'Primordial Sea');\r\n\t\t}\r\n\t\tvalue.abilityModify(0, 'No Guard');\r\n\t\tif (move.flags.kick) {\r\n\t\t\tvalue.abilityModify(0, 'Striker');\r\n\t\t}\r\n\t\tif (!value.value) return value;\r\n\r\n\t\t// OHKO moves don't use standard accuracy / evasion modifiers\r\n\t\tif (move.ohko) {\r\n\t\t\tif (this.battle.gen === 1) {\r\n\t\t\t\tvalue.set(value.value, `fails if target's Speed is higher`);\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t\tif (move.id === 'sheercold' && this.battle.gen >= 7 && !this.pokemonHasType(pokemon, 'Ice')) {\r\n\t\t\t\tvalue.set(20, 'not Ice-type');\r\n\t\t\t}\r\n\t\t\tif (target) {\r\n\t\t\t\tif (pokemon.level < target.level) {\r\n\t\t\t\t\tvalue.reset(0);\r\n\t\t\t\t\tvalue.set(0, \"FAILS: target's level is higher\");\r\n\t\t\t\t} else if (pokemon.level > target.level) {\r\n\t\t\t\t\tvalue.set(value.value + pokemon.level - target.level, \"+1% per level above target\");\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (pokemon.level < 100) value.set(value.value, \"fails if target's level is higher\");\r\n\t\t\t\tif (pokemon.level > 1) value.set(value.value, \"+1% per level above target\");\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Accuracy modifiers start\r\n\r\n\t\tlet accuracyModifiers = [];\r\n\t\tif (this.battle.hasPseudoWeather('Gravity')) {\r\n\t\t\taccuracyModifiers.push(6840);\r\n\t\t\tvalue.modify(5 / 3, \"Gravity\");\r\n\t\t}\r\n\t\tvalue.abilityModify(1.3, \"Compound Eyes\");\r\n\t\tconst species = this.battle.dex.species.get(pokemon.speciesForme)\r\n\t\tif (species.name === 'Blobbos-Partner' && value.tryItem(\"Partner's Pendant\")) {\r\n\t\t\tvalue.modify(1.5, \"Partner's Pendant\");\r\n\t\t}\r\n\t\tvalue.abilityModify(1.3, \"Illuminate\");\r\n\t\tfor (const active of pokemon.side.active) {\r\n\t\t\tif (!active || active.fainted) continue;\r\n\t\t\tconst ability = this.getAllyAbility(active);\r\n\t\t\tif (ability === 'Victory Star') {\r\n\t\t\t\taccuracyModifiers.push(4506);\r\n\t\t\t\tvalue.modify(1.1, \"Victory Star\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (value.tryAbility('Hustle') && move.category === 'Physical') {\r\n\t\t\taccuracyModifiers.push(3277);\r\n\t\t\tvalue.abilityModify(0.8, \"Hustle\");\r\n\t\t} else if (value.tryAbility('Compound Eyes')) {\r\n\t\t\taccuracyModifiers.push(5325);\r\n\t\t\tvalue.abilityModify(1.3, \"Compound Eyes\");\r\n\t\t}\r\n\r\n\t\tif (value.tryItem('Wide Lens')) {\r\n\t\t\taccuracyModifiers.push(4505);\r\n\t\t\tvalue.itemModify(1.1, \"Wide Lens\");\r\n\t\t}\r\n\r\n\t\t// Chaining modifiers\r\n\t\tlet chain = 4096;\r\n\t\tfor (const mod of accuracyModifiers) {\r\n\t\t\tif (mod !== 4096) {\r\n\t\t\t\tchain = (chain * mod + 2048) >> 12;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Applying modifiers\r\n\t\tvalue.set(move.accuracy as number);\r\n\r\n\t\tif (move.id === 'hurricane' || move.id === 'thunder') {\r\n\t\t\tif (value.tryWeather('Sunny Day')) value.set(50, 'Sunny Day');\r\n\t\t\tif (value.tryWeather('Desolate Land')) value.set(50, 'Desolate Land');\r\n\t\t}\r\n\r\n\t\tif (value.tryWeather('Dense Fog')) {\r\n\t\t\tvalue.modify(3 / 5, 'Dense Fog');\r\n\r\n\t\t\tif (value.tryAbility('Fog of War')) {\r\n\t\t\t\tvalue.modify(2, 'Fog of War');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Chained modifiers round down on 0.5\r\n\t\tlet accuracyAfterChain = (value.value * chain) / 4096;\r\n\t\taccuracyAfterChain = accuracyAfterChain % 1 > 0.5 ? Math.ceil(accuracyAfterChain) : Math.floor(accuracyAfterChain);\r\n\t\tvalue.set(accuracyAfterChain);\r\n\r\n\t\t// Unlike for Atk, Def, etc. accuracy and evasion boosts are applied after modifiers\r\n\t\tif (pokemon?.boosts.accuracy) {\r\n\t\t\tif (pokemon.boosts.accuracy > 0) {\r\n\t\t\t\tvalue.set(Math.floor(value.value * (pokemon.boosts.accuracy + 3) / 3));\r\n\t\t\t} else {\r\n\t\t\t\tvalue.set(Math.floor(value.value * 3 / (3 - pokemon.boosts.accuracy)));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 1/256 glitch\r\n\t\tif (this.battle.gen === 1 && !toID(this.battle.tier).includes('stadium')) {\r\n\t\t\tvalue.set((Math.floor(value.value * 255 / 100) / 256) * 100);\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\t// Gets the proper current base power for moves which have a variable base power.\r\n\t// Takes into account the target for some moves.\r\n\t// If it is unsure of the actual base power, it gives an estimate.\r\n\tgetMoveBasePower(move: Move, moveType: TypeName, value: ModifiableValue, target: Pokemon | null = null) {\r\n\t\tconst pokemon = value.pokemon!;\r\n\t\tconst serverPokemon = value.serverPokemon;\r\n\r\n\t\t// apply modifiers for moves that depend on the actual stats\r\n\t\tconst modifiedStats = this.calculateModifiedStats(pokemon, serverPokemon);\r\n\r\n\t\tvalue.reset(move.basePower);\r\n\r\n\t\tif (move.id === 'acrobatics') {\r\n\t\t\tif (!serverPokemon.item) {\r\n\t\t\t\tvalue.modify(2, \"Acrobatics + no item\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (['crushgrip', 'wringout'].includes(move.id) && target) {\r\n\t\t\tvalue.set(\r\n\t\t\t\tMath.floor(Math.floor((120 * (100 * Math.floor(target.hp * 4096 / target.maxhp)) + 2048 - 1) / 4096) / 100) || 1,\r\n\t\t\t\t'approximate'\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (move.id === 'brine' && target && target.hp * 2 <= target.maxhp) {\r\n\t\t\tvalue.modify(2, 'Brine + target below half HP');\r\n\t\t}\r\n\t\tif (move.id === 'eruption' || move.id === 'waterspout' || move.id === 'dragonenergy') {\r\n\t\t\tvalue.set(Math.floor(150 * pokemon.hp / pokemon.maxhp) || 1);\r\n\t\t}\r\n\t\tif (move.id === 'facade' && !['', 'slp', 'frz'].includes(pokemon.status)) {\r\n\t\t\tvalue.modify(2, 'Facade + status');\r\n\t\t}\r\n\t\tif (move.id === 'flail' || move.id === 'reversal') {\r\n\t\t\tlet multiplier;\r\n\t\t\tlet ratios;\r\n\t\t\tif (this.battle.gen > 4) {\r\n\t\t\t\tmultiplier = 48;\r\n\t\t\t\tratios = [2, 5, 10, 17, 33];\r\n\t\t\t} else {\r\n\t\t\t\tmultiplier = 64;\r\n\t\t\t\tratios = [2, 6, 13, 22, 43];\r\n\t\t\t}\r\n\t\t\tlet ratio = pokemon.hp * multiplier / pokemon.maxhp;\r\n\t\t\tlet basePower;\r\n\t\t\tif (ratio < ratios[0]) basePower = 200;\r\n\t\t\telse if (ratio < ratios[1]) basePower = 150;\r\n\t\t\telse if (ratio < ratios[2]) basePower = 100;\r\n\t\t\telse if (ratio < ratios[3]) basePower = 80;\r\n\t\t\telse if (ratio < ratios[4]) basePower = 40;\r\n\t\t\telse basePower = 20;\r\n\t\t\tvalue.set(basePower);\r\n\t\t}\r\n\t\tif (['hex', 'infernalparade'].includes(move.id) && target?.status) {\r\n\t\t\tvalue.modify(2, move.name + ' + status');\r\n\t\t}\r\n\t\tif (move.id === 'lastrespects') {\r\n\t\t\tvalue.set(Math.min(50 + 50 * pokemon.side.faintCounter));\r\n\t\t}\r\n\t\tif (move.id === 'punishment' && target) {\r\n\t\t\tlet boostCount = 0;\r\n\t\t\tfor (const boost of Object.values(target.boosts)) {\r\n\t\t\t\tif (boost > 0) boostCount += boost;\r\n\t\t\t}\r\n\t\t\tvalue.set(Math.min(60 + 20 * boostCount, 200));\r\n\t\t}\r\n\t\tif (move.id === 'smellingsalts' && target) {\r\n\t\t\tif (target.status === 'par') {\r\n\t\t\t\tvalue.modify(2, 'Smelling Salts + Paralysis');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (['storedpower', 'powertrip'].includes(move.id) && target) {\r\n\t\t\tlet boostCount = 0;\r\n\t\t\tfor (const boost of Object.values(pokemon.boosts)) {\r\n\t\t\t\tif (boost > 0) boostCount += boost;\r\n\t\t\t}\r\n\t\t\tvalue.set(20 + 20 * boostCount);\r\n\t\t}\r\n\t\tif (move.id === 'trumpcard') {\r\n\t\t\tconst ppLeft = 5 - this.ppUsed(move, pokemon);\r\n\t\t\tlet basePower = 40;\r\n\t\t\tif (ppLeft === 1) basePower = 200;\r\n\t\t\telse if (ppLeft === 2) basePower = 80;\r\n\t\t\telse if (ppLeft === 3) basePower = 60;\r\n\t\t\telse if (ppLeft === 4) basePower = 50;\r\n\t\t\tvalue.set(basePower);\r\n\t\t}\r\n\t\tif (move.id === 'magnitude') {\r\n\t\t\tvalue.setRange(10, 150);\r\n\t\t}\r\n\t\tif (['venoshock', 'barbbarrage'].includes(move.id) && target) {\r\n\t\t\tif (['psn', 'tox'].includes(target.status)) {\r\n\t\t\t\tvalue.modify(2, move.name + ' + Poison');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (move.id === 'wakeupslap' && target) {\r\n\t\t\tif (target.status === 'slp') {\r\n\t\t\t\tvalue.modify(2, 'Wake-Up Slap + Sleep');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (move.id === 'weatherball') {\r\n\t\t\tif (this.battle.weather !== 'deltastream') {\r\n\t\t\t\tvalue.weatherModify(2);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (move.id === 'hydrosteam') {\r\n\t\t\tvalue.weatherModify(1.5, 'Sunny Day');\r\n\t\t}\r\n\t\tif (move.id === 'psyblade' && this.battle.hasPseudoWeather('Electric Terrain')) {\r\n\t\t\tvalue.modify(1.5, 'Electric Terrain');\r\n\t\t}\r\n\t\tif (move.id === 'terrainpulse' && pokemon.isGrounded(serverPokemon)) {\r\n\t\t\tif (\r\n\t\t\t\tthis.battle.hasPseudoWeather('Electric Terrain') ||\r\n\t\t\t\tthis.battle.hasPseudoWeather('Grassy Terrain') ||\r\n\t\t\t\tthis.battle.hasPseudoWeather('Misty Terrain') ||\r\n\t\t\t\tthis.battle.hasPseudoWeather('Psychic Terrain')\r\n\t\t\t) {\r\n\t\t\t\tvalue.modify(2, 'Terrain Pulse boost');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (\r\n\t\t\tmove.id === 'watershuriken' && pokemon.getSpeciesForme() === 'Greninja-Ash' && pokemon.ability === 'Battle Bond'\r\n\t\t) {\r\n\t\t\tvalue.set(20, 'Battle Bond');\r\n\t\t}\r\n\t\t// Moves that check opponent speed\r\n\t\tif (move.id === 'electroball' && target) {\r\n\t\t\tlet [minSpe, maxSpe] = this.getSpeedRange(target);\r\n\t\t\tlet minRatio = (modifiedStats.spe / maxSpe);\r\n\t\t\tlet maxRatio = (modifiedStats.spe / minSpe);\r\n\t\t\tlet min;\r\n\t\t\tlet max;\r\n\r\n\t\t\tif (minRatio >= 4) min = 150;\r\n\t\t\telse if (minRatio >= 3) min = 120;\r\n\t\t\telse if (minRatio >= 2) min = 80;\r\n\t\t\telse if (minRatio >= 1) min = 60;\r\n\t\t\telse min = 40;\r\n\r\n\t\t\tif (maxRatio >= 4) max = 150;\r\n\t\t\telse if (maxRatio >= 3) max = 120;\r\n\t\t\telse if (maxRatio >= 2) max = 80;\r\n\t\t\telse if (maxRatio >= 1) max = 60;\r\n\t\t\telse max = 40;\r\n\r\n\t\t\tvalue.setRange(min, max);\r\n\t\t}\r\n\t\tif (move.id === 'gyroball' && target) {\r\n\t\t\tlet [minSpe, maxSpe] = this.getSpeedRange(target);\r\n\t\t\tlet min = (Math.floor(25 * minSpe / modifiedStats.spe) || 1);\r\n\t\t\tif (min > 150) min = 150;\r\n\t\t\tlet max = (Math.floor(25 * maxSpe / modifiedStats.spe) || 1);\r\n\t\t\tif (max > 150) max = 150;\r\n\t\t\tvalue.setRange(min, max);\r\n\t\t}\r\n\t\t// Moves which have base power changed due to items\r\n\t\tif (serverPokemon.item) {\r\n\t\t\tlet item = this.battle.dex.items.get(serverPokemon.item);\r\n\t\t\tif (move.id === 'fling' && item.fling) {\r\n\t\t\t\tvalue.itemModify(item.fling.basePower);\r\n\t\t\t}\r\n\t\t\tif (move.id === 'naturalgift') {\r\n\t\t\t\tvalue.itemModify(item.naturalGift.basePower);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Moves which have base power changed according to weight\r\n\t\tif (['lowkick', 'grassknot', 'heavyslam', 'heatcrash'].includes(move.id)) {\r\n\t\t\tlet isGKLK = ['lowkick', 'grassknot'].includes(move.id);\r\n\t\t\tif (target) {\r\n\t\t\t\tlet targetWeight = target.getWeightKg();\r\n\t\t\t\tlet pokemonWeight = pokemon.getWeightKg(serverPokemon);\r\n\t\t\t\tlet basePower;\r\n\t\t\t\tif (isGKLK) {\r\n\t\t\t\t\tbasePower = 20;\r\n\t\t\t\t\tif (targetWeight >= 200) basePower = 120;\r\n\t\t\t\t\telse if (targetWeight >= 100) basePower = 100;\r\n\t\t\t\t\telse if (targetWeight >= 50) basePower = 80;\r\n\t\t\t\t\telse if (targetWeight >= 25) basePower = 60;\r\n\t\t\t\t\telse if (targetWeight >= 10) basePower = 40;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbasePower = 40;\r\n\t\t\t\t\tif (pokemonWeight >= targetWeight * 5) basePower = 120;\r\n\t\t\t\t\telse if (pokemonWeight >= targetWeight * 4) basePower = 100;\r\n\t\t\t\t\telse if (pokemonWeight >= targetWeight * 3) basePower = 80;\r\n\t\t\t\t\telse if (pokemonWeight >= targetWeight * 2) basePower = 60;\r\n\t\t\t\t}\r\n\t\t\t\tif (target.volatiles['dynamax']) {\r\n\t\t\t\t\tvalue.set(0, 'blocked by target\\'s Dynamax');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue.set(basePower);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvalue.setRange(isGKLK ? 20 : 40, 120);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Base power based on times hit\r\n\t\tif (move.id === 'ragefist') {\r\n\t\t\tvalue.set(Math.min(350, 50 + 50 * pokemon.timesAttacked),\r\n\t\t\t\tpokemon.timesAttacked > 0\r\n\t\t\t\t\t? `Hit ${pokemon.timesAttacked} time${pokemon.timesAttacked > 1 ? 's' : ''}`\r\n\t\t\t\t\t: undefined);\r\n\t\t}\r\n\t\tif (!value.value) return value;\r\n\r\n\t\t// Other ability boosts\r\n\t\tif (pokemon.status === 'brn' && move.category === 'Special') {\r\n\t\t\tvalue.abilityModify(1.5, \"Flare Boost\");\r\n\t\t}\r\n\t\tif (move.flags['punch']) {\r\n\t\t\tvalue.abilityModify(1.2, 'Iron Fist');\r\n\t\t}\r\n\t\tif (move.flags['pulse']) {\r\n\t\t\tvalue.abilityModify(1.5, \"Mega Launcher\");\r\n\t\t}\r\n\t\tif (move.flags['bite']) {\r\n\t\t\tvalue.abilityModify(1.5, \"Strong Jaw\");\r\n\t\t}\r\n\t\tif (value.value <= 60) {\r\n\t\t\tvalue.abilityModify(1.5, \"Technician\");\r\n\t\t}\r\n\t\tif (['psn', 'tox'].includes(pokemon.status) && move.category === 'Physical') {\r\n\t\t\tvalue.abilityModify(1.5, \"Toxic Boost\");\r\n\t\t}\r\n\t\tif (this.battle.gen > 2 && serverPokemon.status === 'brn' && move.id !== 'facade' && move.category === 'Physical') {\r\n\t\t\tif (!value.tryAbility(\"Guts\") || !value.tryAbility(\"Flare Heal\")) value.modify(0.5, 'Burn');\r\n\t\t}\r\n\t\tif (['Rock', 'Ground', 'Steel'].includes(moveType) && this.battle.weather === 'sandstorm') {\r\n\t\t\tif (value.tryAbility(\"Sand Force\")) value.weatherModify(1.3, \"Sandstorm\", \"Sand Force\");\r\n\t\t}\r\n\t\tif (move.secondaries) {\r\n\t\t\tvalue.abilityModify(1.3, \"Sheer Force\");\r\n\t\t}\r\n\t\tif (move.flags['contact']) {\r\n\t\t\tvalue.abilityModify(1.3, \"Tough Claws\");\r\n\t\t}\r\n\t\tif (move.flags['sound']) {\r\n\t\t\tvalue.abilityModify(1.3, \"Punk Rock\");\r\n\t\t}\r\n\t\tif (move.flags['slicing']) {\r\n\t\t\tvalue.abilityModify(1.5, \"Sharpness\");\r\n\t\t\tvalue.abilityModify(1.2, 'Blademaster');\r\n\t\t}\r\n\t\tfor (let i = 1; i <= 5 && i <= pokemon.side.faintCounter; i++) {\r\n\t\t\tif (pokemon.volatiles[`fallen${i}`]) {\r\n\t\t\t\tvalue.abilityModify(1 + 0.1 * i, \"Supreme Overlord\");\r\n\t\t\t}\r\n\t\t\tif (pokemon.volatiles[`risen${i}`]) {\r\n\t\t\t\tvalue.abilityModify(1 + 0.1 * i, \"Supreme Underlord\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (target) {\r\n\t\t\tif ([\"MF\", \"FM\"].includes(pokemon.gender + target.gender)) {\r\n\t\t\t\tvalue.abilityModify(0.75, \"Rivalry\");\r\n\t\t\t} else if ([\"MM\", \"FF\"].includes(pokemon.gender + target.gender)) {\r\n\t\t\t\tvalue.abilityModify(1.25, \"Rivalry\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst noTypeOverride = [\r\n\t\t\t'judgment', 'multiattack', 'naturalgift', 'revelationdance', 'struggle', 'technoblast', 'terrainpulse', 'weatherball',\r\n\t\t];\r\n\t\tconst allowTypeOverride = !noTypeOverride.includes(move.id) && (move.id !== 'terablast' || !pokemon.terastallized);\r\n\t\tif (\r\n\t\t\tmove.category !== 'Status' && allowTypeOverride && !move.isZ && !move.isMax &&\r\n\t\t\t!move.id.startsWith('hiddenpower')\r\n\t\t) {\r\n\t\t\tif (move.type === 'Normal') {\r\n\t\t\t\tvalue.abilityModify(this.battle.gen > 6 ? 1.2 : 1.3, \"Aerilate\");\r\n\t\t\t\tvalue.abilityModify(this.battle.gen > 6 ? 1.2 : 1.3, \"Galvanize\");\r\n\t\t\t\tvalue.abilityModify(this.battle.gen > 6 ? 1.2 : 1.3, \"Pixilate\");\r\n\t\t\t\tvalue.abilityModify(this.battle.gen > 6 ? 1.2 : 1.3, \"Refrigerate\");\r\n\t\t\t\tvalue.abilityModify(this.battle.gen > 6 ? 1.2 : 1.3, \"Degenerate\");\r\n\t\t\t\tvalue.abilityModify(this.battle.gen > 6 ? 1.2 : 1.3, \"He Will Be Dragon\");\r\n\t\t\t}\r\n\t\t\tif (this.battle.gen > 6) {\r\n\t\t\t\tvalue.abilityModify(1.2, \"Normalize\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (move.flags['kick']) {\r\n\t\t\tvalue.abilityModify(1.2, 'Striker');\r\n\t\t}\r\n\t\tif (move.flags['hammer']) {\r\n\t\t\tvalue.abilityModify(1.2, 'Admin Abuse');\r\n\t\t}\r\n\t\tif (move.recoil || move.hasCrashDamage) {\r\n\t\t\tvalue.abilityModify(1.2, 'Reckless');\r\n\t\t}\r\n\t\tif (move.type === 'Poison') {\r\n\t\t\tvalue.abilityModify(1.5, 'Pozzed');\r\n\t\t}\r\n\t\tif (move.type === 'Ghost') {\r\n\t\t\tvalue.abilityModify(1.5, 'Phantasma');\r\n\t\t}\r\n\t\tif (pokemon?.volatiles['agile']) {\r\n\t\t\tvalue.abilityModify(0.75, 'Ancient Style');\r\n\t\t} else if (pokemon?.volatiles['strong']) {\r\n\t\t\tvalue.abilityModify(1.25, 'Ancient Style');\r\n\t\t}\r\n\r\n\t\tif (move.category !== 'Status') {\r\n\t\t\tlet auraBoosted = '';\r\n\t\t\tlet auraBroken = false;\r\n\t\t\tfor (const ally of pokemon.side.active) {\r\n\t\t\t\tif (!ally || ally.fainted) continue;\r\n\t\t\t\tlet allyAbility = this.getAllyAbility(ally);\r\n\t\t\t\tif (moveType === 'Fairy' && allyAbility === 'Fairy Aura') {\r\n\t\t\t\t\tauraBoosted = 'Fairy Aura';\r\n\t\t\t\t} else if (moveType === 'Dark' && allyAbility === 'Dark Aura') {\r\n\t\t\t\t\tauraBoosted = 'Dark Aura';\r\n\t\t\t\t} else if (allyAbility === 'Aura Break') {\r\n\t\t\t\t\tauraBroken = true;\r\n\t\t\t\t} else if (allyAbility === 'Battery' && ally !== pokemon && move.category === 'Special') {\r\n\t\t\t\t\tvalue.modify(1.3, 'Battery');\r\n\t\t\t\t} else if (allyAbility === 'Power Spot' && ally !== pokemon) {\r\n\t\t\t\t\tvalue.modify(1.3, 'Power Spot');\r\n\t\t\t\t} else if (allyAbility === 'Steely Spirit' && moveType === 'Steel') {\r\n\t\t\t\t\tvalue.modify(1.5, 'Steely Spirit');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (const foe of pokemon.side.foe.active) {\r\n\t\t\t\tif (!foe || foe.fainted) continue;\r\n\t\t\t\tif (foe.ability === 'Fairy Aura' && moveType === 'Fairy') {\r\n\t\t\t\t\tauraBoosted = 'Fairy Aura';\r\n\t\t\t\t} else if (foe.ability === 'Dark Aura' && moveType === 'Dark') {\r\n\t\t\t\t\tauraBoosted = 'Dark Aura';\r\n\t\t\t\t} else if (foe.ability === 'Aura Break') {\r\n\t\t\t\t\tauraBroken = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (auraBoosted) {\r\n\t\t\t\tif (auraBroken) {\r\n\t\t\t\t\tvalue.modify(0.75, auraBoosted + ' + Aura Break');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue.modify(1.33, auraBoosted);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Terrain\r\n\t\tif ((this.battle.hasPseudoWeather('Electric Terrain') && moveType === 'Electric') ||\r\n\t\t\t(this.battle.hasPseudoWeather('Grassy Terrain') && moveType === 'Grass') ||\r\n\t\t\t(this.battle.hasPseudoWeather('Psychic Terrain') && moveType === 'Psychic')) {\r\n\t\t\tif (pokemon.isGrounded(serverPokemon)) {\r\n\t\t\t\tvalue.modify(this.battle.gen > 7 ? 1.3 : 1.5, 'Terrain boost');\r\n\t\t\t}\r\n\t\t} else if (this.battle.hasPseudoWeather('Misty Terrain') && moveType === 'Dragon') {\r\n\t\t\tif (target ? target.isGrounded() : true) {\r\n\t\t\t\tvalue.modify(0.5, 'Misty Terrain + grounded target');\r\n\t\t\t}\r\n\t\t} else if (\r\n\t\t\tthis.battle.hasPseudoWeather('Grassy Terrain') && ['earthquake', 'bulldoze', 'magnitude'].includes(move.id)\r\n\t\t) {\r\n\t\t\tif (target ? target.isGrounded() : true) {\r\n\t\t\t\tvalue.modify(0.5, 'Grassy Terrain + grounded target');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (\r\n\t\t\tmove.id === 'expandingforce' &&\r\n\t\t\tthis.battle.hasPseudoWeather('Psychic Terrain') &&\r\n\t\t\tpokemon.isGrounded(serverPokemon)\r\n\t\t) {\r\n\t\t\tvalue.modify(1.5, 'Expanding Force + Psychic Terrain boost');\r\n\t\t}\r\n\t\tif (move.id === 'mistyexplosion' && this.battle.hasPseudoWeather('Misty Terrain')) {\r\n\t\t\tvalue.modify(1.5, 'Misty Explosion + Misty Terrain boost');\r\n\t\t}\r\n\t\tif (move.id === 'risingvoltage' && this.battle.hasPseudoWeather('Electric Terrain') && target?.isGrounded()) {\r\n\t\t\tvalue.modify(2, 'Rising Voltage + Electric Terrain boost');\r\n\t\t}\r\n\t\tif (\r\n\t\t\tmove.id === 'steelroller' &&\r\n\t\t\t!this.battle.hasPseudoWeather('Electric Terrain') &&\r\n\t\t\t!this.battle.hasPseudoWeather('Grassy Terrain') &&\r\n\t\t\t!this.battle.hasPseudoWeather('Misty Terrain') &&\r\n\t\t\t!this.battle.hasPseudoWeather('Psychic Terrain')\r\n\t\t) {\r\n\t\t\tvalue.set(0, 'no Terrain');\r\n\t\t}\r\n\r\n\t\t// Item\r\n\t\tvalue = this.getItemBoost(move, value, moveType);\r\n\r\n\t\treturn value;\r\n\t}\r\n\r\n\tstatic incenseTypes: {[itemName: string]: TypeName} = {\r\n\t\t'Odd Incense': 'Psychic',\r\n\t\t'Rock Incense': 'Rock',\r\n\t\t'Rose Incense': 'Grass',\r\n\t\t'Sea Incense': 'Water',\r\n\t\t'Wave Incense': 'Water',\r\n\t};\r\n\tstatic itemTypes: {[itemName: string]: TypeName} = {\r\n\t\t'Black Belt': 'Fighting',\r\n\t\t'Black Glasses': 'Dark',\r\n\t\t'Charcoal': 'Fire',\r\n\t\t'Dragon Fang': 'Dragon',\r\n\t\t'Hard Stone': 'Rock',\r\n\t\t'Magnet': 'Electric',\r\n\t\t'Metal Coat': 'Steel',\r\n\t\t'Miracle Seed': 'Grass',\r\n\t\t'Mystic Water': 'Water',\r\n\t\t'Never-Melt Ice': 'Ice',\r\n\t\t'Poison Barb': 'Poison',\r\n\t\t'Sharp Beak': 'Flying',\r\n\t\t'Silk Scarf': 'Normal',\r\n\t\t'Silver Powder': 'Bug',\r\n\t\t'Soft Sand': 'Ground',\r\n\t\t'Spell Tag': 'Ghost',\r\n\t\t'Twisted Spoon': 'Psychic',\r\n\t\t'Katana': 'Steel',\r\n\t\t'Cute Bow': 'Fairy',\r\n\t};\r\n\tstatic orbUsers: {[speciesForme: string]: string[]} = {\r\n\t\t'Latias': ['Soul Dew'],\r\n\t\t'Latios': ['Soul Dew'],\r\n\t\t'Dialga': ['Adamant Crystal', 'Adamant Orb'],\r\n\t\t'Palkia': ['Lustrous Globe', 'Lustrous Orb'],\r\n\t\t'Giratina': ['Griseous Core', 'Griseous Orb'],\r\n\t\t'Venomicon': ['Vile Vial'],\r\n\t};\r\n\tstatic orbTypes: {[itemName: string]: TypeName[]} = {\r\n\t\t'Soul Dew': ['Psychic', 'Dragon'],\r\n\t\t'Adamant Crystal': ['Steel', 'Dragon'],\r\n\t\t'Adamant Orb': ['Steel', 'Dragon'],\r\n\t\t'Lustrous Globe': ['Water', 'Dragon'],\r\n\t\t'Lustrous Orb': ['Water', 'Dragon'],\r\n\t\t'Griseous Core': ['Ghost', 'Dragon'],\r\n\t\t'Griseous Orb': ['Ghost', 'Dragon'],\r\n\t\t'Vile Vial': ['Poison', 'Flying'],\r\n\t};\r\n\tstatic noGemMoves = [\r\n\t\t'Fire Pledge',\r\n\t\t'Fling',\r\n\t\t'Grass Pledge',\r\n\t\t'Struggle',\r\n\t\t'Water Pledge',\r\n\t];\r\n\tgetItemBoost(move: Move, value: ModifiableValue, moveType: TypeName) {\r\n\t\tlet item = this.battle.dex.items.get(value.serverPokemon.item);\r\n\t\tlet itemName = item.name;\r\n\t\tlet moveName = move.name;\r\n\t\tlet species = this.battle.dex.species.get(value.serverPokemon.speciesForme);\r\n\t\tlet isTransform = value.pokemon.volatiles.transform;\r\n\t\tlet speciesName = isTransform && value.pokemon.volatiles.formechange?.[1] && this.battle.gen <= 4 ?\r\n\t\t\tthis.battle.dex.species.get(value.pokemon.volatiles.formechange[1]).baseSpecies : species.baseSpecies;\r\n\r\n\t\t// Plates\r\n\t\tif (item.onPlate === moveType && !item.zMove) {\r\n\t\t\tvalue.itemModify(1.2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Incenses\r\n\t\tif (BattleTooltips.incenseTypes[item.name] === moveType) {\r\n\t\t\tvalue.itemModify(1.2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Type-enhancing items\r\n\t\tif (BattleTooltips.itemTypes[item.name] === moveType) {\r\n\t\t\tvalue.itemModify(this.battle.gen < 4 ? 1.1 : 1.2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Light ball is a base power modifier in gen 4 only\r\n\t\tif (item.name === 'Light Ball' && this.battle.gen === 4 && speciesName === 'Pikachu') {\r\n\t\t\tvalue.itemModify(2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Pokemon-specific items\r\n\t\tif (item.name === 'Soul Dew' && this.battle.gen < 7) return value;\r\n\t\tif (BattleTooltips.orbUsers[speciesName]?.includes(item.name) &&\r\n\t\t\tBattleTooltips.orbTypes[item.name]?.includes(moveType)) {\r\n\t\t\tvalue.itemModify(1.2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\tif ((speciesName.startsWith('Ogerpon-Wellspring') && itemName === 'Wellspring Mask') ||\r\n\t\t\t(speciesName.startsWith('Ogerpon-Hearthflame') && itemName === 'Hearthflame Mask') ||\r\n\t\t\t(speciesName.startsWith('Ogerpon-Cornerstone') && itemName === 'Cornerstone Mask')) {\r\n\t\t\tvalue.itemModify(1.2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\tif (item.name === 'Manifesto' && this.battle.dex.species.get(value.serverPokemon.speciesForme).baseSpecies === 'Walruskie' && ['Steel', 'Ice'].includes(moveType)) {\r\n\t\t\tvalue.itemModify(1.5);\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\tif (item.name === \"Pirate's Jug\" && this.battle.dex.species.get(value.serverPokemon.speciesForme).baseSpecies === 'Octai' && moveName === 'Lactose Shot') {\r\n\t\t\tvalue.itemModify(2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Gems\r\n\t\tif (BattleTooltips.noGemMoves.includes(moveName)) return value;\r\n\t\tif (itemName === moveType + ' Gem') {\r\n\t\t\tvalue.itemModify(this.battle.gen < 6 ? 1.5 : this.battle.gen === 8 ? 1.5 : 1.3);\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\tif (itemName === 'Muscle Band' && move.category === 'Physical' ||\r\n\t\t\titemName === 'Wise Glasses' && move.category === 'Special' ||\r\n\t\t\titemName === 'Punching Glove' && move.flags['punch']) {\r\n\t\t\tvalue.itemModify(1.1);\r\n\t\t}\r\n\r\n\t\treturn value;\r\n\t}\r\n\tgetPokemonTypes(pokemon: Pokemon | ServerPokemon, preterastallized = false): ReadonlyArray<TypeName> {\r\n\t\tif (!(pokemon as Pokemon).getTypes) {\r\n\t\t\treturn this.battle.dex.species.get(pokemon.speciesForme).types;\r\n\t\t}\r\n\r\n\t\treturn (pokemon as Pokemon).getTypeList(undefined, preterastallized);\r\n\t}\r\n\tpokemonHasType(pokemon: Pokemon | ServerPokemon, type: TypeName, types?: ReadonlyArray<TypeName>) {\r\n\t\tif (!types) types = this.getPokemonTypes(pokemon);\r\n\t\tfor (const curType of types) {\r\n\t\t\tif (curType === type) return true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tgetAllyAbility(ally: Pokemon) {\r\n\t\t// this will only be available if the ability announced itself in some way\r\n\t\tlet allyAbility = this.battle.dex.abilities.get(ally.ability).name;\r\n\t\t// otherwise fall back on the original set data sent from the server\r\n\t\tif (!allyAbility) {\r\n\t\t\tif (this.battle.myAllyPokemon) { // multi battle ally\r\n\t\t\t\tallyAbility = this.battle.dex.abilities.get(this.battle.myAllyPokemon[ally.slot].ability || '').name;\r\n\t\t\t} else if (this.battle.myPokemon) {\r\n\t\t\t\tallyAbility = this.battle.dex.abilities.get(this.battle.myPokemon[ally.slot].ability || '').name;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn allyAbility;\r\n\t}\r\n\tgetPokemonAbilityData(clientPokemon: Pokemon | null, serverPokemon: ServerPokemon | null | undefined) {\r\n\t\tconst abilityData: {ability: string, baseAbility: string, possibilities: string[]} = {\r\n\t\t\tability: '', baseAbility: '', possibilities: [],\r\n\t\t};\r\n\t\tif (clientPokemon) {\r\n\t\t\tif (clientPokemon.ability) {\r\n\t\t\t\tabilityData.ability = clientPokemon.ability || clientPokemon.baseAbility;\r\n\t\t\t\tif (clientPokemon.baseAbility) {\r\n\t\t\t\t\tabilityData.baseAbility = clientPokemon.baseAbility;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst speciesForme = clientPokemon.getSpeciesForme() || serverPokemon?.speciesForme || '';\r\n\t\t\t\tconst species = this.battle.dex.species.get(speciesForme);\r\n\t\t\t\tif (species.exists && species.abilities) {\r\n\t\t\t\t\tabilityData.possibilities = [species.abilities['0']];\r\n\t\t\t\t\tif (species.abilities['1']) abilityData.possibilities.push(species.abilities['1']);\r\n\t\t\t\t\tif (species.abilities['H']) abilityData.possibilities.push(species.abilities['H']);\r\n\t\t\t\t\tif (species.abilities['S']) abilityData.possibilities.push(species.abilities['S']);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (serverPokemon) {\r\n\t\t\tif (!abilityData.ability) abilityData.ability = serverPokemon.ability || serverPokemon.baseAbility;\r\n\t\t\tif (!abilityData.baseAbility && serverPokemon.baseAbility) {\r\n\t\t\t\tabilityData.baseAbility = serverPokemon.baseAbility;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn abilityData;\r\n\t}\r\n\tgetPokemonAbilityText(\r\n\t\tclientPokemon: Pokemon | null,\r\n\t\tserverPokemon: ServerPokemon | null | undefined,\r\n\t\tisActive: boolean | undefined,\r\n\t\thidePossible?: boolean\r\n\t) {\r\n\t\tlet text = '';\r\n\t\tconst abilityData = this.getPokemonAbilityData(clientPokemon, serverPokemon);\r\n\t\tif (!isActive) {\r\n\t\t\t// for switch tooltips, only show the original ability\r\n\t\t\tconst ability = abilityData.baseAbility || abilityData.ability;\r\n\t\t\tif (ability) text = '<small>Ability:</small> ' + this.battle.dex.abilities.get(ability).name;\r\n\t\t} else {\r\n\t\t\tif (abilityData.ability) {\r\n\t\t\t\tconst abilityName = this.battle.dex.abilities.get(abilityData.ability).name;\r\n\t\t\t\ttext = '<small>Ability:</small> ' + abilityName;\r\n\t\t\t\tconst baseAbilityName = this.battle.dex.abilities.get(abilityData.baseAbility).name;\r\n\t\t\t\tif (baseAbilityName && baseAbilityName !== abilityName) text += ' (base: ' + baseAbilityName + ')';\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!text && abilityData.possibilities.length && !hidePossible) {\r\n\t\t\ttext = '<small>Possible abilities:</small> ' + abilityData.possibilities.join(', ');\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n}\r\n\r\ntype StatsTable = {hp: number, atk: number, def: number, spa: number, spd: number, spe: number};\r\n\r\n/**\r\n * PokemonSet can be sparse, in which case that entry should be\r\n * inferred from the rest of the set, according to sensible\r\n * defaults.\r\n */\r\ninterface PokemonSet {\r\n\t/** Defaults to species name (not including forme), like in games */\r\n\tname?: string;\r\n\tspecies: string;\r\n\t/** Defaults to no item */\r\n\titem?: string;\r\n\t/** Defaults to no ability (error in Gen 3+) */\r\n\tability?: string;\r\n\tmoves: string[];\r\n\t/** Defaults to no nature (error in Gen 3+) */\r\n\tnature?: NatureName;\r\n\t/** Defaults to random legal gender, NOT subject to gender ratios */\r\n\tgender?: string;\r\n\t/** Defaults to flat 252's (200's/0's in Let's Go) (error in gen 3+) */\r\n\tevs?: StatsTable;\r\n\t/** Defaults to whatever makes sense - flat 31's unless you have Gyro Ball etc */\r\n\tivs?: StatsTable;\r\n\t/** Defaults as you'd expect (100 normally, 50 in VGC-likes, 5 in LC) */\r\n\tlevel?: number;\r\n\t/** Defaults to no (error if shiny event) */\r\n\tshiny?: boolean;\r\n\t/** Defaults to 255 unless you have Frustration, in which case 0 */\r\n\thappiness?: number;\r\n\t/** Defaults to event required ball, otherwise Poké Ball */\r\n\tpokeball?: string;\r\n\t/** Defaults to the type of your Hidden Power in Moves, otherwise Dark */\r\n\thpType?: string;\r\n\t/** Defaults to 10 */\r\n\tdynamaxLevel?: number;\r\n\t/** Defaults to no (can only be yes for certain Pokemon) */\r\n\tgigantamax?: boolean;\r\n\t/** Defaults to the primary type */\r\n\tteraType?: string;\r\n}\r\n\r\nclass BattleStatGuesser {\r\n\tformatid: ID;\r\n\tdex: ModdedDex;\r\n\tmoveCount: any = null;\r\n\thasMove: any = null;\r\n\r\n\tignoreEVLimits: boolean;\r\n\tsupportsEVs: boolean;\r\n\tsupportsAVs: boolean;\r\n\r\n\tconstructor(formatid: ID) {\r\n\t\tthis.formatid = formatid;\r\n\t\tlet gen = +formatid.slice(3,4)\r\n\t\tif (Number.isNaN(gen)) {\r\n\t\t\tgen = 8;\r\n\t\t}\r\n\t\tconst modMatch = this.formatid.match(/^gen(\\d+)([a-z]+)(only|nationaldex)/);\r\n\t\tif (modMatch) {\r\n\t\t\tconst [, genNumber, modName, modified] = modMatch;\r\n\t\t\tif (!Number.isNaN(parseInt(genNumber, 10))) {\r\n\t\t\t\tgen = parseInt(genNumber, 10);\r\n\t\t\t}\r\n\t\t\tthis.dex = Dex.mod(gen, `${modName}${modified === 'only' ? 'only' : 'natdex'}` as ID);\r\n\t\t} else {\r\n\t\t\tthis.dex = formatid ? Dex.mod(8) : Dex;\r\n\t\t}\r\n\r\n\t\tthis.ignoreEVLimits = (\r\n\t\t\tthis.dex.gen < 3 ||\r\n\t\t\t((this.formatid.endsWith('hackmons') || this.formatid.endsWith('bh')) && this.dex.gen !== 6) ||\r\n\t\t\tthis.formatid.includes('metronomebattle') ||\r\n\t\t\tthis.formatid.endsWith('norestrictions')\r\n\t\t);\r\n\t\tthis.supportsEVs = !this.formatid.includes('letsgo');\r\n\t\tthis.supportsAVs = !this.supportsEVs && this.formatid.endsWith('norestrictions');\r\n\t}\r\n\tguess(set: PokemonSet) {\r\n\t\tlet role = this.guessRole(set);\r\n\t\tlet comboEVs = this.guessEVs(set, role);\r\n\t\tlet evs = {hp: 0, atk: 0, def: 0, spa: 0, spd: 0, spe: 0};\r\n\t\tfor (let stat in evs) {\r\n\t\t\tevs[stat as StatName] = comboEVs[stat as StatName] || 0;\r\n\t\t}\r\n\t\tlet plusStat = comboEVs.plusStat || '';\r\n\t\tlet minusStat = comboEVs.minusStat || '';\r\n\t\treturn {role, evs, plusStat, minusStat, moveCount: this.moveCount, hasMove: this.hasMove};\r\n\t}\r\n\tguessRole(set: PokemonSet) {\r\n\t\tif (!set) return '?';\r\n\t\tif (!set.moves) return '?';\r\n\r\n\t\tlet moveCount = {\r\n\t\t\t'Physical': 0,\r\n\t\t\t'Special': 0,\r\n\t\t\t'PhysicalAttack': 0,\r\n\t\t\t'SpecialAttack': 0,\r\n\t\t\t'PhysicalSetup': 0,\r\n\t\t\t'SpecialSetup': 0,\r\n\t\t\t'Support': 0,\r\n\t\t\t'Setup': 0,\r\n\t\t\t'Restoration': 0,\r\n\t\t\t'Offense': 0,\r\n\t\t\t'Stall': 0,\r\n\t\t\t'SpecialStall': 0,\r\n\t\t\t'PhysicalStall': 0,\r\n\t\t\t'Fast': 0,\r\n\t\t\t'Ultrafast': 0,\r\n\t\t\t'bulk': 0,\r\n\t\t\t'specialBulk': 0,\r\n\t\t\t'physicalBulk': 0,\r\n\t\t};\r\n\t\tlet hasMove: {[moveid: string]: 1} = {};\r\n\t\tlet itemid = toID(set.item);\r\n\t\tlet item = this.dex.items.get(itemid);\r\n\t\tlet abilityid = toID(set.ability);\r\n\r\n\t\tlet species = this.dex.species.get(set.species || set.name!);\r\n\t\tif (item.megaEvolves === species.name) species = this.dex.species.get(item.megaStone);\r\n\t\tif (!species.exists) return '?';\r\n\t\tlet stats = species.baseStats;\r\n\r\n\t\tif (set.moves.length < 1) return '?';\r\n\t\tlet needsFourMoves = !['unown', 'ditto'].includes(species.id);\r\n\t\tlet moveids = set.moves.map(toID);\r\n\t\tif (moveids.includes('lastresort' as ID)) needsFourMoves = false;\r\n\t\tif (set.moves.length < 4 && needsFourMoves && !this.formatid.includes('metronomebattle')) {\r\n\t\t\treturn '?';\r\n\t\t}\r\n\r\n\t\tfor (let i = 0, len = set.moves.length; i < len; i++) {\r\n\t\t\tlet move = this.dex.moves.get(set.moves[i]);\r\n\t\t\thasMove[move.id] = 1;\r\n\t\t\tif (move.category === 'Status') {\r\n\t\t\t\tif (['batonpass', 'healingwish', 'lunardance'].includes(move.id)) {\r\n\t\t\t\t\tmoveCount['Support']++;\r\n\t\t\t\t} else if (['metronome', 'assist', 'copycat', 'mefirst', 'photongeyser', 'shellsidearm'].includes(move.id)) {\r\n\t\t\t\t\tmoveCount['Physical'] += 0.5;\r\n\t\t\t\t\tmoveCount['Special'] += 0.5;\r\n\t\t\t\t} else if (move.id === 'naturepower') {\r\n\t\t\t\t\tmoveCount['Special']++;\r\n\t\t\t\t} else if (['protect', 'detect', 'spikyshield', 'kingsshield'].includes(move.id)) {\r\n\t\t\t\t\tmoveCount['Stall']++;\r\n\t\t\t\t} else if (move.id === 'wish') {\r\n\t\t\t\t\tmoveCount['Restoration']++;\r\n\t\t\t\t\tmoveCount['Stall']++;\r\n\t\t\t\t\tmoveCount['Support']++;\r\n\t\t\t\t} else if (move.heal) {\r\n\t\t\t\t\tmoveCount['Restoration']++;\r\n\t\t\t\t\tmoveCount['Stall']++;\r\n\t\t\t\t} else if (move.target === 'self') {\r\n\t\t\t\t\tif (['agility', 'rockpolish', 'shellsmash', 'growth', 'workup'].includes(move.id)) {\r\n\t\t\t\t\t\tmoveCount['PhysicalSetup']++;\r\n\t\t\t\t\t\tmoveCount['SpecialSetup']++;\r\n\t\t\t\t\t} else if (['dragondance', 'swordsdance', 'coil', 'bulkup', 'curse', 'bellydrum'].includes(move.id)) {\r\n\t\t\t\t\t\tmoveCount['PhysicalSetup']++;\r\n\t\t\t\t\t} else if (['nastyplot', 'tailglow', 'quiverdance', 'calmmind', 'geomancy'].includes(move.id)) {\r\n\t\t\t\t\t\tmoveCount['SpecialSetup']++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (move.id === 'substitute') moveCount['Stall']++;\r\n\t\t\t\t\tmoveCount['Setup']++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (['toxic', 'leechseed', 'willowisp'].includes(move.id)) {\r\n\t\t\t\t\t\tmoveCount['Stall']++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmoveCount['Support']++;\r\n\t\t\t\t}\r\n\t\t\t} else if (['counter', 'endeavor', 'metalburst', 'mirrorcoat', 'rapidspin'].includes(move.id)) {\r\n\t\t\t\tmoveCount['Support']++;\r\n\t\t\t} else if ([\r\n\t\t\t\t'nightshade', 'seismictoss', 'psywave', 'superfang', 'naturesmadness', 'foulplay', 'endeavor', 'finalgambit', 'bodypress',\r\n\t\t\t].includes(move.id)) {\r\n\t\t\t\tmoveCount['Offense']++;\r\n\t\t\t} else if (move.id === 'fellstinger') {\r\n\t\t\t\tmoveCount['PhysicalSetup']++;\r\n\t\t\t\tmoveCount['Setup']++;\r\n\t\t\t} else {\r\n\t\t\t\tmoveCount[move.category]++;\r\n\t\t\t\tmoveCount['Offense']++;\r\n\t\t\t\tif (move.id === 'knockoff') {\r\n\t\t\t\t\tmoveCount['Support']++;\r\n\t\t\t\t}\r\n\t\t\t\tif (['scald', 'voltswitch', 'uturn', 'flipturn'].includes(move.id)) {\r\n\t\t\t\t\tmoveCount[move.category] -= 0.2;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hasMove['batonpass']) moveCount['Support'] += moveCount['Setup'];\r\n\t\tmoveCount['PhysicalAttack'] = moveCount['Physical'];\r\n\t\tmoveCount['Physical'] += moveCount['PhysicalSetup'];\r\n\t\tmoveCount['SpecialAttack'] = moveCount['Special'];\r\n\t\tmoveCount['Special'] += moveCount['SpecialSetup'];\r\n\r\n\t\tif (hasMove['dragondance'] || hasMove['quiverdance']) moveCount['Ultrafast'] = 1;\r\n\r\n\t\tlet isFast = (stats.spe >= 80);\r\n\t\tlet physicalBulk = (stats.hp + 75) * (stats.def + 87);\r\n\t\tlet specialBulk = (stats.hp + 75) * (stats.spd + 87);\r\n\r\n\t\tif (hasMove['willowisp'] || hasMove['acidarmor'] || hasMove['irondefense'] || hasMove['cottonguard']) {\r\n\t\t\tphysicalBulk *= 1.6;\r\n\t\t\tmoveCount['PhysicalStall']++;\r\n\t\t} else if (hasMove['scald'] || hasMove['bulkup'] || hasMove['coil'] || hasMove['cosmicpower']) {\r\n\t\t\tphysicalBulk *= 1.3;\r\n\t\t\tif (hasMove['scald']) { // partial stall goes in reverse\r\n\t\t\t\tmoveCount['SpecialStall']++;\r\n\t\t\t} else {\r\n\t\t\t\tmoveCount['PhysicalStall']++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (abilityid === 'flamebody') physicalBulk *= 1.1;\r\n\r\n\t\tif (hasMove['calmmind'] || hasMove['quiverdance'] || hasMove['geomancy']) {\r\n\t\t\tspecialBulk *= 1.3;\r\n\t\t\tmoveCount['SpecialStall']++;\r\n\t\t}\r\n\t\tif (abilityid === 'sandstream' && species.types.includes('Rock')) {\r\n\t\t\tspecialBulk *= 1.5;\r\n\t\t}\r\n\r\n\t\tif (hasMove['bellydrum']) {\r\n\t\t\tphysicalBulk *= 0.6;\r\n\t\t\tspecialBulk *= 0.6;\r\n\t\t}\r\n\t\tif (moveCount['Restoration']) {\r\n\t\t\tphysicalBulk *= 1.5;\r\n\t\t\tspecialBulk *= 1.5;\r\n\t\t} else if (hasMove['painsplit'] && hasMove['substitute']) {\r\n\t\t\t// SubSplit isn't generally a stall set\r\n\t\t\tmoveCount['Stall']--;\r\n\t\t} else if (hasMove['painsplit'] || hasMove['rest']) {\r\n\t\t\tphysicalBulk *= 1.4;\r\n\t\t\tspecialBulk *= 1.4;\r\n\t\t}\r\n\t\tif ((hasMove['bodyslam'] || hasMove['thunder']) && abilityid === 'serenegrace' || hasMove['thunderwave']) {\r\n\t\t\tphysicalBulk *= 1.1;\r\n\t\t\tspecialBulk *= 1.1;\r\n\t\t}\r\n\t\tif ((hasMove['ironhead'] || hasMove['airslash']) && abilityid === 'serenegrace') {\r\n\t\t\tphysicalBulk *= 1.1;\r\n\t\t\tspecialBulk *= 1.1;\r\n\t\t}\r\n\t\tif (hasMove['gigadrain'] || hasMove['drainpunch'] || hasMove['hornleech']) {\r\n\t\t\tphysicalBulk *= 1.15;\r\n\t\t\tspecialBulk *= 1.15;\r\n\t\t}\r\n\t\tif (itemid === 'leftovers' || itemid === 'blacksludge') {\r\n\t\t\tphysicalBulk *= 1 + 0.1 * (1 + moveCount['Stall'] / 1.5);\r\n\t\t\tspecialBulk *= 1 + 0.1 * (1 + moveCount['Stall'] / 1.5);\r\n\t\t}\r\n\t\tif (hasMove['leechseed']) {\r\n\t\t\tphysicalBulk *= 1 + 0.1 * (1 + moveCount['Stall'] / 1.5);\r\n\t\t\tspecialBulk *= 1 + 0.1 * (1 + moveCount['Stall'] / 1.5);\r\n\t\t}\r\n\t\tif ((itemid === 'flameorb' || itemid === 'toxicorb') && abilityid !== 'magicguard') {\r\n\t\t\tif (itemid === 'toxicorb' && abilityid === 'poisonheal') {\r\n\t\t\t\tphysicalBulk *= 1 + 0.1 * (2 + moveCount['Stall']);\r\n\t\t\t\tspecialBulk *= 1 + 0.1 * (2 + moveCount['Stall']);\r\n\t\t\t} else {\r\n\t\t\t\tphysicalBulk *= 0.8;\r\n\t\t\t\tspecialBulk *= 0.8;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (itemid === 'lifeorb') {\r\n\t\t\tphysicalBulk *= 0.7;\r\n\t\t\tspecialBulk *= 0.7;\r\n\t\t}\r\n\t\tif (abilityid === 'multiscale' || abilityid === 'magicguard' || abilityid === 'regenerator') {\r\n\t\t\tphysicalBulk *= 1.4;\r\n\t\t\tspecialBulk *= 1.4;\r\n\t\t}\r\n\t\tif (itemid === 'eviolite') {\r\n\t\t\tphysicalBulk *= 1.5;\r\n\t\t\tspecialBulk *= 1.5;\r\n\t\t}\r\n\t\tif (itemid === 'assaultvest') {\r\n\t\t\tspecialBulk *= 1.5;\r\n\t\t}\r\n\r\n\t\tlet bulk = physicalBulk + specialBulk;\r\n\t\tif (bulk < 46000 && stats.spe >= 70) isFast = true;\r\n\t\tif (hasMove['trickroom']) isFast = false;\r\n\t\tmoveCount['bulk'] = bulk;\r\n\t\tmoveCount['physicalBulk'] = physicalBulk;\r\n\t\tmoveCount['specialBulk'] = specialBulk;\r\n\r\n\t\tif (\r\n\t\t\thasMove['agility'] || hasMove['dragondance'] || hasMove['quiverdance'] ||\r\n\t\t\thasMove['rockpolish'] || hasMove['shellsmash'] || hasMove['flamecharge']\r\n\t\t) {\r\n\t\t\tisFast = true;\r\n\t\t} else if (abilityid === 'unburden' || abilityid === 'speedboost' || abilityid === 'motordrive') {\r\n\t\t\tisFast = true;\r\n\t\t\tmoveCount['Ultrafast'] = 1;\r\n\t\t} else if (abilityid === 'chlorophyll' || abilityid === 'swiftswim' || abilityid === 'sandrush') {\r\n\t\t\tisFast = true;\r\n\t\t\tmoveCount['Ultrafast'] = 2;\r\n\t\t} else if (itemid === 'salacberry') {\r\n\t\t\tisFast = true;\r\n\t\t}\r\n\t\tconst ultrafast = hasMove['agility'] || hasMove['shellsmash'] ||\r\n\t\t\thasMove['autotomize'] || hasMove['shiftgear'] || hasMove['rockpolish'];\r\n\t\tif (ultrafast) {\r\n\t\t\tmoveCount['Ultrafast'] = 2;\r\n\t\t}\r\n\t\tmoveCount['Fast'] = isFast ? 1 : 0;\r\n\r\n\t\tthis.moveCount = moveCount;\r\n\t\tthis.hasMove = hasMove;\r\n\r\n\t\tif (species.id === 'ditto') return abilityid === 'imposter' ? 'Physically Defensive' : 'Fast Bulky Support';\r\n\t\tif (species.id === 'shedinja') return 'Fast Physical Sweeper';\r\n\r\n\t\tif (itemid === 'choiceband' && moveCount['PhysicalAttack'] >= 2) {\r\n\t\t\tif (!isFast) return 'Bulky Band';\r\n\t\t\treturn 'Fast Band';\r\n\t\t} else if (itemid === 'choicespecs' && moveCount['SpecialAttack'] >= 2) {\r\n\t\t\tif (!isFast) return 'Bulky Specs';\r\n\t\t\treturn 'Fast Specs';\r\n\t\t} else if (itemid === 'choicescarf') {\r\n\t\t\tif (moveCount['PhysicalAttack'] === 0) return 'Special Scarf';\r\n\t\t\tif (moveCount['SpecialAttack'] === 0) return 'Physical Scarf';\r\n\t\t\tif (moveCount['PhysicalAttack'] > moveCount['SpecialAttack']) return 'Physical Biased Mixed Scarf';\r\n\t\t\tif (moveCount['PhysicalAttack'] < moveCount['SpecialAttack']) return 'Special Biased Mixed Scarf';\r\n\t\t\tif (stats.atk < stats.spa) return 'Special Biased Mixed Scarf';\r\n\t\t\treturn 'Physical Biased Mixed Scarf';\r\n\t\t}\r\n\r\n\t\tif (species.id === 'unown') return 'Fast Special Sweeper';\r\n\r\n\t\tif (moveCount['PhysicalStall'] && moveCount['Restoration']) {\r\n\t\t\tif (stats.spe > 110 && abilityid !== 'prankster') return 'Fast Bulky Support';\r\n\t\t\treturn 'Specially Defensive';\r\n\t\t}\r\n\t\tif (moveCount['SpecialStall'] && moveCount['Restoration'] && itemid !== 'lifeorb') {\r\n\t\t\tif (stats.spe > 110 && abilityid !== 'prankster') return 'Fast Bulky Support';\r\n\t\t\treturn 'Physically Defensive';\r\n\t\t}\r\n\r\n\t\tlet offenseBias: 'Physical' | 'Special' = 'Physical';\r\n\t\tif (stats.spa > stats.atk && moveCount['Special'] > 1) offenseBias = 'Special';\r\n\t\telse if (stats.atk > stats.spa && moveCount['Physical'] > 1) offenseBias = 'Physical';\r\n\t\telse if (moveCount['Special'] > moveCount['Physical']) offenseBias = 'Special';\r\n\r\n\t\tif (moveCount['Stall'] + moveCount['Support'] / 2 <= 2 && bulk < 135000 && moveCount[offenseBias] >= 1.5) {\r\n\t\t\tif (isFast) {\r\n\t\t\t\tif (bulk > 80000 && !moveCount['Ultrafast']) return 'Bulky ' + offenseBias + ' Sweeper';\r\n\t\t\t\treturn 'Fast ' + offenseBias + ' Sweeper';\r\n\t\t\t} else {\r\n\t\t\t\tif (moveCount[offenseBias] >= 3 || moveCount['Stall'] <= 0) {\r\n\t\t\t\t\treturn 'Bulky ' + offenseBias + ' Sweeper';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (isFast && abilityid !== 'prankster') {\r\n\t\t\tif (stats.spe > 100 || bulk < 55000 || moveCount['Ultrafast']) {\r\n\t\t\t\treturn 'Fast Bulky Support';\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (moveCount['SpecialStall']) return 'Physically Defensive';\r\n\t\tif (moveCount['PhysicalStall']) return 'Specially Defensive';\r\n\t\tif (species.id === 'blissey' || species.id === 'chansey') return 'Physically Defensive';\r\n\t\tif (specialBulk >= physicalBulk) return 'Specially Defensive';\r\n\t\treturn 'Physically Defensive';\r\n\t}\r\n\tensureMinEVs(evs: StatsTable, stat: StatName, min: number, evTotal: number) {\r\n\t\tif (!evs[stat]) evs[stat] = 0;\r\n\t\tlet diff = min - evs[stat];\r\n\t\tif (diff <= 0) return evTotal;\r\n\t\tif (evTotal <= 504) {\r\n\t\t\tlet change = Math.min(508 - evTotal, diff);\r\n\t\t\tevTotal += change;\r\n\t\t\tevs[stat] += change;\r\n\t\t\tdiff -= change;\r\n\t\t}\r\n\t\tif (diff <= 0) return evTotal;\r\n\t\tlet evPriority = {def: 1, spd: 1, hp: 1, atk: 1, spa: 1, spe: 1};\r\n\t\tlet prioStat: StatName;\r\n\t\tfor (prioStat in evPriority) {\r\n\t\t\tif (prioStat === stat) continue;\r\n\t\t\tif (evs[prioStat] && evs[prioStat] > 128) {\r\n\t\t\t\tevs[prioStat] -= diff;\r\n\t\t\t\tevs[stat] += diff;\r\n\t\t\t\treturn evTotal;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn evTotal; // can't do it :(\r\n\t}\r\n\tensureMaxEVs(evs: StatsTable, stat: StatName, min: number, evTotal: number) {\r\n\t\tif (!evs[stat]) evs[stat] = 0;\r\n\t\tlet diff = evs[stat] - min;\r\n\t\tif (diff <= 0) return evTotal;\r\n\t\tevs[stat] -= diff;\r\n\t\tevTotal -= diff;\r\n\t\treturn evTotal; // can't do it :(\r\n\t}\r\n\tguessEVs(set: PokemonSet, role: string): Partial<StatsTable> & {plusStat?: StatName | '', minusStat?: StatName | ''} {\r\n\t\tif (!set) return {};\r\n\t\tif (role === '?') return {};\r\n\t\tlet species = this.dex.species.get(set.species || set.name!);\r\n\t\tlet stats = species.baseStats;\r\n\r\n\t\tlet hasMove = this.hasMove;\r\n\t\tlet moveCount = this.moveCount;\r\n\r\n\t\tlet evs: StatsTable & {plusStat?: StatName | '', minusStat?: StatName | ''} = {\r\n\t\t\thp: 0, atk: 0, def: 0, spa: 0, spd: 0, spe: 0,\r\n\t\t};\r\n\t\tlet plusStat: StatName | '' = '';\r\n\t\tlet minusStat: StatName | '' = '';\r\n\r\n\t\tlet statChart: {[role: string]: [StatName, StatName]} = {\r\n\t\t\t'Bulky Band': ['atk', 'hp'],\r\n\t\t\t'Fast Band': ['spe', 'atk'],\r\n\t\t\t'Bulky Specs': ['spa', 'hp'],\r\n\t\t\t'Fast Specs': ['spe', 'spa'],\r\n\t\t\t'Physical Scarf': ['spe', 'atk'],\r\n\t\t\t'Special Scarf': ['spe', 'spa'],\r\n\t\t\t'Physical Biased Mixed Scarf': ['spe', 'atk'],\r\n\t\t\t'Special Biased Mixed Scarf': ['spe', 'spa'],\r\n\t\t\t'Fast Physical Sweeper': ['spe', 'atk'],\r\n\t\t\t'Fast Special Sweeper': ['spe', 'spa'],\r\n\t\t\t'Bulky Physical Sweeper': ['atk', 'hp'],\r\n\t\t\t'Bulky Special Sweeper': ['spa', 'hp'],\r\n\t\t\t'Fast Bulky Support': ['spe', 'hp'],\r\n\t\t\t'Physically Defensive': ['def', 'hp'],\r\n\t\t\t'Specially Defensive': ['spd', 'hp'],\r\n\t\t};\r\n\r\n\t\tplusStat = statChart[role][0];\r\n\t\tif (role === 'Fast Bulky Support') moveCount['Ultrafast'] = 0;\r\n\t\tif (plusStat === 'spe' && moveCount['Ultrafast']) {\r\n\t\t\tif (statChart[role][1] === 'atk' || statChart[role][1] === 'spa') {\r\n\t\t\t\tplusStat = statChart[role][1];\r\n\t\t\t} else if (moveCount['Physical'] >= 3) {\r\n\t\t\t\tplusStat = 'atk';\r\n\t\t\t} else if (stats.spd > stats.def) {\r\n\t\t\t\tplusStat = 'spd';\r\n\t\t\t} else {\r\n\t\t\t\tplusStat = 'def';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.supportsAVs) {\r\n\t\t\t// Let's Go, AVs enabled\r\n\t\t\tevs = {hp: 200, atk: 200, def: 200, spa: 200, spd: 200, spe: 200};\r\n\t\t\tif (!moveCount['PhysicalAttack']) evs.atk = 0;\r\n\t\t\tif (!moveCount['SpecialAttack']) evs.spa = 0;\r\n\t\t\tif (hasMove['gyroball'] || hasMove['trickroom']) evs.spe = 0;\r\n\t\t} else if (!this.supportsEVs) {\r\n\t\t\t// Let's Go, AVs disabled\r\n\t\t\t// no change\r\n\t\t} else if (this.ignoreEVLimits) {\r\n\t\t\t// Gen 1-2, hackable EVs (like Hackmons)\r\n\t\t\tevs = {hp: 252, atk: 252, def: 252, spa: 252, spd: 252, spe: 252};\r\n\t\t\tif (!moveCount['PhysicalAttack']) evs.atk = 0;\r\n\t\t\tif (!moveCount['SpecialAttack'] && this.dex.gen > 1) evs.spa = 0;\r\n\t\t\tif (hasMove['gyroball'] || hasMove['trickroom']) evs.spe = 0;\r\n\t\t\tif (this.dex.gen === 1) evs.spd = 0;\r\n\t\t\tif (this.dex.gen < 3) return evs;\r\n\t\t} else {\r\n\t\t\t// Normal Gen 3-7\r\n\t\t\tif (!statChart[role]) return {};\r\n\r\n\t\t\tlet evTotal = 0;\r\n\r\n\t\t\tlet primaryStat = statChart[role][0];\r\n\t\t\tlet stat = this.getStat(primaryStat, set, 252, plusStat === primaryStat ? 1.1 : 1.0);\r\n\t\t\tlet ev = 252;\r\n\t\t\twhile (ev > 0 && stat <= this.getStat(primaryStat, set, ev - 4, plusStat === primaryStat ? 1.1 : 1.0)) ev -= 4;\r\n\t\t\tevs[primaryStat] = ev;\r\n\t\t\tevTotal += ev;\r\n\r\n\t\t\tlet secondaryStat: StatName | null = statChart[role][1];\r\n\t\t\tif (secondaryStat === 'hp' && set.level && set.level < 20) secondaryStat = 'spd';\r\n\t\t\tstat = this.getStat(secondaryStat, set, 252, plusStat === secondaryStat ? 1.1 : 1.0);\r\n\t\t\tev = 252;\r\n\t\t\twhile (ev > 0 && stat <= this.getStat(secondaryStat, set, ev - 4, plusStat === secondaryStat ? 1.1 : 1.0)) ev -= 4;\r\n\t\t\tevs[secondaryStat] = ev;\r\n\t\t\tevTotal += ev;\r\n\r\n\t\t\tlet SRweaknesses = ['Fire', 'Flying', 'Bug', 'Ice'];\r\n\t\t\tlet SRresistances = ['Ground', 'Steel', 'Fighting'];\r\n\t\t\tlet SRweak = 0;\r\n\t\t\tif (set.ability !== 'Magic Guard' && set.ability !== 'Mountaineer') {\r\n\t\t\t\tif (SRweaknesses.indexOf(species.types[0]) >= 0) {\r\n\t\t\t\t\tSRweak++;\r\n\t\t\t\t} else if (SRresistances.indexOf(species.types[0]) >= 0) {\r\n\t\t\t\t\tSRweak--;\r\n\t\t\t\t}\r\n\t\t\t\tif (SRweaknesses.indexOf(species.types[1]) >= 0) {\r\n\t\t\t\t\tSRweak++;\r\n\t\t\t\t} else if (SRresistances.indexOf(species.types[1]) >= 0) {\r\n\t\t\t\t\tSRweak--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet hpDivisibility = 0;\r\n\t\t\tlet hpShouldBeDivisible = false;\r\n\t\t\tlet hp = evs['hp'] || 0;\r\n\t\t\tstat = this.getStat('hp', set, hp, 1);\r\n\t\t\tif ((set.item === 'Leftovers' || set.item === 'Black Sludge') && hasMove['substitute'] && stat !== 404) {\r\n\t\t\t\thpDivisibility = 4;\r\n\t\t\t} else if (set.item === 'Leftovers' || set.item === 'Black Sludge') {\r\n\t\t\t\thpDivisibility = 0;\r\n\t\t\t} else if (hasMove['bellydrum'] && (set.item || '').slice(-5) === 'Berry') {\r\n\t\t\t\thpDivisibility = 2;\r\n\t\t\t\thpShouldBeDivisible = true;\r\n\t\t\t} else if (hasMove['substitute'] && (set.item || '').slice(-5) === 'Berry') {\r\n\t\t\t\thpDivisibility = 4;\r\n\t\t\t\thpShouldBeDivisible = true;\r\n\t\t\t} else if (SRweak >= 2 || hasMove['bellydrum']) {\r\n\t\t\t\thpDivisibility = 2;\r\n\t\t\t} else if (SRweak >= 1 || hasMove['substitute'] || hasMove['transform']) {\r\n\t\t\t\thpDivisibility = 4;\r\n\t\t\t} else if (set.ability !== 'Magic Guard') {\r\n\t\t\t\thpDivisibility = 8;\r\n\t\t\t}\r\n\r\n\t\t\tif (hpDivisibility) {\r\n\t\t\t\twhile (hp < 252 && evTotal < 508 && !(stat % hpDivisibility) !== hpShouldBeDivisible) {\r\n\t\t\t\t\thp += 4;\r\n\t\t\t\t\tstat = this.getStat('hp', set, hp, 1);\r\n\t\t\t\t\tevTotal += 4;\r\n\t\t\t\t}\r\n\t\t\t\twhile (hp > 0 && !(stat % hpDivisibility) !== hpShouldBeDivisible) {\r\n\t\t\t\t\thp -= 4;\r\n\t\t\t\t\tstat = this.getStat('hp', set, hp, 1);\r\n\t\t\t\t\tevTotal -= 4;\r\n\t\t\t\t}\r\n\t\t\t\twhile (hp > 0 && stat === this.getStat('hp', set, hp - 4, 1)) {\r\n\t\t\t\t\thp -= 4;\r\n\t\t\t\t\tevTotal -= 4;\r\n\t\t\t\t}\r\n\t\t\t\tif (hp || evs['hp']) evs['hp'] = hp;\r\n\t\t\t}\r\n\r\n\t\t\tif (species.id === 'tentacruel') {\r\n\t\t\t\tevTotal = this.ensureMinEVs(evs, 'spe', 16, evTotal);\r\n\t\t\t} else if (species.id === 'skarmory') {\r\n\t\t\t\tevTotal = this.ensureMinEVs(evs, 'spe', 24, evTotal);\r\n\t\t\t} else if (species.id === 'jirachi') {\r\n\t\t\t\tevTotal = this.ensureMinEVs(evs, 'spe', 32, evTotal);\r\n\t\t\t} else if (species.id === 'celebi') {\r\n\t\t\t\tevTotal = this.ensureMinEVs(evs, 'spe', 36, evTotal);\r\n\t\t\t} else if (species.id === 'volcarona') {\r\n\t\t\t\tevTotal = this.ensureMinEVs(evs, 'spe', 52, evTotal);\r\n\t\t\t} else if (species.id === 'gliscor') {\r\n\t\t\t\tevTotal = this.ensureMinEVs(evs, 'spe', 72, evTotal);\r\n\t\t\t} else if (species.id === 'dragonite' && evs['hp']) {\r\n\t\t\t\tevTotal = this.ensureMaxEVs(evs, 'spe', 220, evTotal);\r\n\t\t\t}\r\n\r\n\t\t\tif (evTotal < 508) {\r\n\t\t\t\tlet remaining = 508 - evTotal;\r\n\t\t\t\tif (remaining > 252) remaining = 252;\r\n\t\t\t\tsecondaryStat = null;\r\n\t\t\t\tif (!evs['atk'] && moveCount['PhysicalAttack'] >= 1) {\r\n\t\t\t\t\tsecondaryStat = 'atk';\r\n\t\t\t\t} else if (!evs['spa'] && moveCount['SpecialAttack'] >= 1) {\r\n\t\t\t\t\tsecondaryStat = 'spa';\r\n\t\t\t\t} else if (stats.hp === 1 && !evs['def']) {\r\n\t\t\t\t\tsecondaryStat = 'def';\r\n\t\t\t\t} else if (stats.def === stats.spd && !evs['spd']) {\r\n\t\t\t\t\tsecondaryStat = 'spd';\r\n\t\t\t\t} else if (!evs['spd']) {\r\n\t\t\t\t\tsecondaryStat = 'spd';\r\n\t\t\t\t} else if (!evs['def']) {\r\n\t\t\t\t\tsecondaryStat = 'def';\r\n\t\t\t\t}\r\n\t\t\t\tif (secondaryStat) {\r\n\t\t\t\t\tev = remaining;\r\n\t\t\t\t\tstat = this.getStat(secondaryStat, set, ev);\r\n\t\t\t\t\twhile (ev > 0 && stat === this.getStat(secondaryStat, set, ev - 4)) ev -= 4;\r\n\t\t\t\t\tif (ev) evs[secondaryStat] = ev;\r\n\t\t\t\t\tremaining -= ev;\r\n\t\t\t\t}\r\n\t\t\t\tif (remaining && !evs['spe']) {\r\n\t\t\t\t\tev = remaining;\r\n\t\t\t\t\tstat = this.getStat('spe', set, ev);\r\n\t\t\t\t\twhile (ev > 0 && stat === this.getStat('spe', set, ev - 4)) ev -= 4;\r\n\t\t\t\t\tif (ev) evs['spe'] = ev;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (hasMove['gyroball'] || hasMove['trickroom']) {\r\n\t\t\tminusStat = 'spe';\r\n\t\t} else if (!moveCount['PhysicalAttack']) {\r\n\t\t\tminusStat = 'atk';\r\n\t\t} else if (moveCount['SpecialAttack'] < 1 && !evs['spa']) {\r\n\t\t\tif (moveCount['SpecialAttack'] < moveCount['PhysicalAttack']) {\r\n\t\t\t\tminusStat = 'spa';\r\n\t\t\t} else if (!evs['atk']) {\r\n\t\t\t\tminusStat = 'atk';\r\n\t\t\t}\r\n\t\t} else if (moveCount['PhysicalAttack'] < 1 && !evs['atk']) {\r\n\t\t\tminusStat = 'atk';\r\n\t\t} else if (stats.def > stats.spe && stats.spd > stats.spe && !evs['spe']) {\r\n\t\t\tminusStat = 'spe';\r\n\t\t} else if (stats.def > stats.spd) {\r\n\t\t\tminusStat = 'spd';\r\n\t\t} else {\r\n\t\t\tminusStat = 'def';\r\n\t\t}\r\n\r\n\t\tif (plusStat === minusStat) {\r\n\t\t\tminusStat = (plusStat === 'spe' ? 'spd' : 'spe');\r\n\t\t}\r\n\r\n\t\tevs.plusStat = plusStat;\r\n\t\tevs.minusStat = minusStat;\r\n\r\n\t\treturn evs;\r\n\t}\r\n\r\n\tgetStat(stat: StatName, set: PokemonSet, evOverride?: number, natureOverride?: number) {\r\n\t\tlet species = this.dex.species.get(set.species);\r\n\t\tif (!species.exists) return 0;\r\n\r\n\t\tlet level = set.level || 100;\r\n\r\n\t\tlet baseStat = species.baseStats[stat];\r\n\r\n\t\tlet iv = (set.ivs && set.ivs[stat]);\r\n\t\tif (typeof iv !== 'number') iv = 31;\r\n\t\tif (this.dex.gen <= 2) iv &= 30;\r\n\r\n\t\tlet ev = (set.evs && set.evs[stat]);\r\n\t\tif (typeof ev !== 'number') ev = (this.dex.gen > 2 ? 0 : 252);\r\n\t\tif (evOverride !== undefined) ev = evOverride;\r\n\r\n\t\tif (stat === 'hp') {\r\n\t\t\tif (baseStat === 1) return 1;\r\n\t\t\tif (!this.supportsEVs) return ~~(~~(2 * baseStat + iv + 100) * level / 100 + 10) + (this.supportsAVs ? ev : 0);\r\n\t\t\treturn ~~(~~(2 * baseStat + iv + ~~(ev / 4) + 100) * level / 100 + 10);\r\n\t\t}\r\n\t\tlet val = ~~(~~(2 * baseStat + iv + ~~(ev / 4)) * level / 100 + 5);\r\n\t\tif (!this.supportsEVs) {\r\n\t\t\tval = ~~(~~(2 * baseStat + iv) * level / 100 + 5);\r\n\t\t}\r\n\t\tif (natureOverride) {\r\n\t\t\tval *= natureOverride;\r\n\t\t} else if (BattleNatures[set.nature!]?.plus === stat) {\r\n\t\t\tval *= 1.1;\r\n\t\t} else if (BattleNatures[set.nature!]?.minus === stat) {\r\n\t\t\tval *= 0.9;\r\n\t\t}\r\n\t\tif (!this.supportsEVs) {\r\n\t\t\tlet friendshipValue = ~~((70 / 255 / 10 + 1) * 100);\r\n\t\t\tval = ~~(val) * friendshipValue / 100 + (this.supportsAVs ? ev : 0);\r\n\t\t}\r\n\t\treturn ~~(val);\r\n\t}\r\n}\r\n\r\nif (typeof require === 'function') {\r\n\t// in Node\r\n\t(global as any).BattleStatGuesser = BattleStatGuesser;\r\n}\r\n"],"mappings":"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","ignoreList":[]}